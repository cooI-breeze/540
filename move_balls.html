<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>球体点击特效</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        
        .settings {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 500px;
            margin-bottom: 20px;
        }
        
        .setting-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="range"] {
            width: 100%;
        }
        
        .value-display {
            text-align: right;
            color: #666;
            font-size: 0.9em;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        #ball-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            overflow: hidden;
            cursor: pointer;
        }
        
        .ball {
            position: absolute;
            border-radius: 50%;
            transition: transform 0.2s;
        }
        
        .ball:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <h1>球体点击特效</h1>
    
    <div class="settings">
        <div class="setting-group">
            <label for="size-range">球体大小范围</label>
            <input type="range" id="size-range" min="0" max="500" value="200">
            <div class="value-display">
                <span id="size-value">200</span> 像素
            </div>
        </div>
        
        <div class="setting-group">
            <label for="speed-range">移动速度</label>
            <input type="range" id="speed-range" min="0" max="20" value="5">
            <div class="value-display">
                <span id="speed-value">5</span>
            </div>
        </div>
        
        <div class="setting-group">
            <label for="count-range">球体数量</label>
            <input type="range" id="count-range" min="0" max="50" value="5">
            <div class="value-display">
                <span id="count-value">5</span> 个
            </div>
        </div>
        
        <button id="start-btn">开始特效</button>
    </div>
    
    <div id="ball-container"></div>
    
    <audio id="pop-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-explosion-2759.mp3" preload="auto"></audio>
    
    <script>
        // 显示滑块当前值
        document.getElementById('size-range').addEventListener('input', function() {
            document.getElementById('size-value').textContent = this.value;
        });
        
        document.getElementById('speed-range').addEventListener('input', function() {
            document.getElementById('speed-value').textContent = this.value;
        });
        
        document.getElementById('count-range').addEventListener('input', function() {
            document.getElementById('count-value').textContent = this.value;
        });
        
        // 开始按钮点击事件
        document.getElementById('start-btn').addEventListener('click', function() {
            const settings = document.querySelector('.settings');
            const ballContainer = document.getElementById('ball-container');
            
            settings.style.display = 'none';
            ballContainer.style.display = 'block';
            
            initBalls();
            clickEffect();//调用特效函数
        });
        
        // 初始化球体
        function initBalls() {
            const container = document.getElementById('ball-container');
            const popSound = document.getElementById('pop-sound');
            
            const sizeRange = parseInt(document.getElementById('size-range').value);
            const speed = parseInt(document.getElementById('speed-range').value);
            const count = parseInt(document.getElementById('count-range').value);
            
            // 清空容器
            container.innerHTML = '';
            
            // 创建球体
            for (let i = 0; i < count; i++) {
                const ball = document.createElement('div');
                ball.className = 'ball';
                
                // 随机大小 (在设定范围内变化)
                const size = Math.max(10, sizeRange * (1 + Math.random()/2));
                ball.style.width = `${size}px`;
                ball.style.height = `${size}px`;
                
                // 随机位置
                const x = Math.random() * (window.innerWidth - size);
                const y = Math.random() * (window.innerHeight - size);
                ball.style.left = `${x}px`;
                ball.style.top = `${y}px`;
                
                // 随机颜色
                const hue = Math.floor(Math.random() * 360);
                ball.style.backgroundColor = `hsl(${hue}, 80%, 60%)`;
                
                // 随机移动方向
                const angle = Math.random() * Math.PI * 2;
                let dx = Math.cos(angle) * speed;
                let dy = Math.sin(angle) * speed;
                
                container.appendChild(ball);
                
                // 点击事件
                ball.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    // 播放音效
                    popSound.currentTime = 0;
                    //  popSound.play();
                    
                    // 添加消失动画
                    this.style.transform = 'scale(1.5)';
                    this.style.opacity = '0';
                    
                    // 移除球体
                    setTimeout(() => {
                        container.removeChild(this);
                    }, 200);
                });
                
                // 动画循环
                function animate() {
                    let x = parseFloat(ball.style.left) + dx;
                    let y = parseFloat(ball.style.top) + dy;
                    
                    // 边界检测
                    if (x <= 0 || x >= window.innerWidth - size) {
                        dx = -dx;
                        x = x <= 0 ? 0 : window.innerWidth - size;
                    }
                    
                    if (y <= 0 || y >= window.innerHeight - size) {
                        dy = -dy;
                        y = y <= 0 ? 0 : window.innerHeight - size;
                    }
                    
                    ball.style.left = `${x}px`;
                    ball.style.top = `${y}px`;
                    
                    requestAnimationFrame(animate);
                }
                
                animate();
            }
        }


        function clickEffect() {
        let balls = [];
        let longPressed = false;
        let longPress;
        let multiplier = 0;
        let width, height;
        let origin;
        let normal;
        let ctx;
        const colours = ["#F73859", "#14FFEC", "#00E0FF", "#FF99FE", "#FAF15D"];
        const canvas = document.createElement("canvas");
        document.body.appendChild(canvas);
        canvas.setAttribute("style", "width: 100%; height: 100%; top: 0; left: 0; z-index: 99999; position: fixed; pointer-events: none;");
        const pointer = document.createElement("span");
        pointer.classList.add("pointer");
        document.body.appendChild(pointer);
        
        if (canvas.getContext ) {
            ctx = canvas.getContext("2d");
            updateSize();
            var my_balls=document.getElementsByClassName("ball");    
            for(var i=0;i<my_balls.length;i++){
            my_balls[i].addEventListener('resize', updateSize, false);
            loop();
            my_balls[i].addEventListener("click", function(e) {
                pushBalls(randBetween(10, 20), e.clientX, e.clientY);
                document.body.classList.add("is-pressed");
                }, false);  
            }
        } 
        
        
        function updateSize() {
            canvas.width = window.innerWidth * 2;
            canvas.height = window.innerHeight * 2;
            canvas.style.width = window.innerWidth + 'px';
            canvas.style.height = window.innerHeight + 'px';
            ctx.scale(2, 2);
            width = (canvas.width = window.innerWidth);
            height = (canvas.height = window.innerHeight);
            origin = {
            x: width / 2,
            y: height / 2
            };
            normal = {
            x: width / 2,
            y: height / 2
            };
        }
        class Ball {
            constructor(x = origin.x, y = origin.y) {
            this.x = x;
            this.y = y;
            this.angle = Math.PI * 2 * Math.random();
            if (longPressed == true) {
                this.multiplier = randBetween(14 + multiplier, 15 + multiplier);
            } else {
                this.multiplier = randBetween(1, 3);
            }
            this.vx = (this.multiplier + Math.random() * 0.5) * Math.cos(this.angle);
            this.vy = (this.multiplier + Math.random() * 0.5) * Math.sin(this.angle);
            this.r = randBetween(8, 12) + 3 * Math.random();
            this.color = colours[Math.floor(Math.random() * colours.length)];
            }
            update() {
            this.x += this.vx - normal.x;
            this.y += this.vy - normal.y;
            normal.x = -2 / window.innerWidth * Math.sin(this.angle);
            normal.y = -2 / window.innerHeight * Math.cos(this.angle);
            this.r -= 0.05;
            this.vx *= 0.98;
            this.vy *= 0.98;
            }
        }
        
        function pushBalls(count = 1, x = origin.x, y = origin.y) {
            for (let i = 0; i < count; i++) {
            balls.push(new Ball(x, y));
            }
        }
        
        function randBetween(min, max) {
            return Math.floor(Math.random() * max) + min;
        }
        
        function loop() {
            ctx.fillStyle = "rgba(255, 255, 255, 0)";
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < balls.length; i++) {
                let b = balls[i];
                if (b.r < 0) continue;
                ctx.fillStyle = b.color;
                ctx.beginPath();
                ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2, false);
                ctx.fill();
                b.update();
            }
            if (longPressed == true) {
            multiplier += 0.2;
            } else if (!longPressed && multiplier >= 0) {
            multiplier -= 0.4;
            }
            removeBall();
            requestAnimationFrame(loop);
        }
        
        function removeBall() {
            for (let i = 0; i < balls.length; i++) {
            let b = balls[i];
            if (b.x + b.r < 0 || b.x - b.r > width || b.y + b.r < 0 || b.y - b.r > height || b.r < 0) {
                balls.splice(i, 1);
            }
            }
        }
        }
    </script>
</body>
</html>
