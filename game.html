<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>game</title>
    <script>
        var round = 1;
        var id = 1;/*动态id*/
        var pid = 10000;/*特效动态id*/
        var state = 0;/*0正常选择,1等待输入对象人物,2等待输入坐标*/;
        var selectid = 0;/*选择目标*/
        var control = 1;/*控制区状态*/
        var range = 0;//选择范围
        var active_fixedid = -1;
        var last_reflect = 9999;
        var acted_fixedid = new Array(10000);

        function next_act() {//下一行动
            var chess = document.getElementById("board").children;
            var active_reflect = -1;
            var active_movement = -1;
            var active_id = id + 1;
            var act_find = 0;
            active_fixedid = -1;
            for (var i = 0; i < chess.length; i++) {//找
                if (chess[i].class != 0 && acted_fixedid[chess[i].fixedid] != 1 && chess[i].reflect <= last_reflect && chess[i].reflect >= 0) {//不是地块，未行动过，比上一个行动的人的反应小，反应大于等于0
                    if (chess[i].fixedid == active_fixedid) continue;
                    if (chess[i].reflect > active_reflect) {
                        active_reflect = chess[i].reflect;
                        active_movement = chess[i].max_movement;
                        active_id = chess[i].id;
                        active_fixedid = chess[i].fixedid;
                        act_find = 1;
                    }
                    else if (chess[i].reflect == active_reflect) {
                        if (chess[i].movement > active_movement) {
                            active_reflect = chess[i].reflect;
                            active_movement = chess[i].max_movement;
                            active_id = chess[i].id;
                            active_fixedid = chess[i].fixedid;
                            act_find = 1;
                        }
                        else if (chess[i].movement == active_movement) {
                            if (chess[i].id < active_id) {
                                active_reflect = chess[i].reflect;
                                active_movement = chess[i].max_movement;
                                active_id = chess[i].id;
                                active_fixedid = chess[i].fixedid;
                                act_find = 1;
                            }
                        }
                    }
                }
            }
            selector(0);
            controller(0);
            if (act_find == 0) {
                round += 1;
                last_reflect = 9999;
                for (var i = 0; i < chess.length; i++) {
                    if (chess[i].class != 0) {
                        chess[i].movement = chess[i].max_movement;
                        if (chess[i].skill1_cooling > 0) { chess[i].skill1_cooling -= 1; }
                        if (chess[i].skill2_cooling > 0) { chess[i].skill2_cooling -= 1; }
                        if (chess[i].skill3_cooling > 0) { chess[i].skill3_cooling -= 1; }
                    }
                }
                acted_fixedid = new Array(10000);
                document.getElementById("round").innerHTML = round;
                document.getElementById("next").style.backgroundImage = "";
            }
            else {
                document.getElementById("next").style.backgroundImage = "url(" + document.getElementById(active_id).img + ")";
                document.getElementById("next").style.backgroundSize = "50px 50px";
                last_reflect = document.getElementById(active_id).reflect;
                acted_fixedid[active_fixedid] = 1;
            }
            overall_skill();
        }
        function overall_skill() {//全局技能模块
            var chess = document.getElementById("board").children;
            var skill = document.getElementById("overall_skill").children;
            for (var i = 0; i < chess.length; i++) {
                if (chess[i].class + 1) { chess[i].skillfunction(chess[i].id); }
            }
            for (var i = 0; i < skill.length; i++) {
                skill[i].skillfunction(skill[i].id);
            }
        }

        function input(form, id, r) {//1人物2坐标
            var chess = document.getElementById(selectid);
            if (chess.fixedid == active_fixedid && chess.reflect != -1) {
                if (state == 0) {
                    if (form == 1) {
                        state = 1;
                        range = r;
                        var input = document.getElementById("controller_page3").querySelector("#" + id);
                        input.src = "./img/void.png";
                        input.value = new Number;
                        input.style.backgroundColor = "rgb(76, 244, 10,0.5)";
                        input.setAttribute("class", "waiting");
                        range_display(1);
                    }
                    if (form == 2) {
                        state = 2;
                        range = r;
                        var input = document.getElementById("controller_page3").querySelector("#" + id);
                        input.src = "./img/void.png";
                        input.value = new Number;
                        input.style.backgroundColor = "rgb(76, 244, 10,0.5)";
                        input.setAttribute("class", "waiting");
                        range_display(1);
                    }
                }
                else if (state != 0) {
                    state = 0;
                    range = 0;
                    var input = document.getElementById("controller_page3").querySelector("#" + id);
                    input.style.backgroundColor = "rgb(0,0,0,0)";
                    input.removeAttribute("class");
                    range_display(0);
                }
            }
        }
        function range_display(i) {
            if (i == 0) {
                if (document.getElementsByClassName("range_display")[0]) {
                    document.getElementById("board").removeChild(document.getElementsByClassName("range_display")[0]);
                }
            }
            if (i == 1) {
                var rimg = document.createElement("img");
                var chess = document.getElementById(selectid);
                rimg.src = "./img/range" + range + ".png";
                rimg.style.position = "absolute";
                rimg.style.height = 25 * 31 + "px";
                rimg.style.width = 25 * 31 + "px";
                rimg.style.left = (chess.x - 16) * 25 + "px";
                rimg.style.bottom = (chess.y - 16) * 25 + "px";
                rimg.style.zIndex = 20;
                rimg.style.pointerEvents = "none";
                rimg.setAttribute("class", "range_display")
                document.getElementById("board").appendChild(rimg);
            }
        }

        function detect_resist(x, y) {/*检测阻挡*/
            var chess = document.getElementById("board").children;
            var bool = 0;
            for (var i = 0; i < chess.length; i++) {
                if (chess[i].x == x && chess[i].y == y && chess[i].resist == 1) {
                    return 1;
                }
                else if (chess[i].x == x && chess[i].y == y && chess[i].class == 0) {
                    bool = 1;
                }
            }
            if (bool == 1) {
                return 0;
            }
            else {
                return 1;
            }
        }
        function detect_range(r, id1, id2) {//范围检测
            var x0 = document.getElementById(id1).x;
            var y0 = document.getElementById(id1).y;
            var x1 = document.getElementById(id2).x;
            var y1 = document.getElementById(id2).y;
            var abs_diff = Math.abs(x1 - x0) + Math.abs(y1 - y0);

            if (r >= 1 && r <= 10) { // 曼哈顿距离小于等于r!=0
                if (abs_diff <= r && abs_diff != 0) {
                    return 1;
                }
                return 0;
            } else if (r === 11) { // 直线
                if ((x0 === x1 || y0 === y1) && abs_diff != 0) {
                    return 1;
                }
                return 0;
            } else if (r === 12) { // 全屏
                return 1;
            }
        }


        function selector(id) {/*选择器*/
            if (id == 0) {//选择器0
                document.getElementById("img").src = "./img/void.png";
                document.getElementById("name").innerHTML = "";
                document.getElementById("max_health").innerHTML = "";
                document.getElementById("health").innerHTML = "";
                document.getElementById("movement").innerHTML = "";
                document.getElementById("max_movement").innerHTML = "";
                document.getElementById("reflect").innerHTML = "";
                document.getElementById("skill1").childNodes[1].src = "./img/void.png";
                document.getElementById("skill1").childNodes[3].innerHTML = "";
                document.getElementById("skill2").childNodes[1].src = "./img/void.png";
                document.getElementById("skill2").childNodes[3].innerHTML = "";
                document.getElementById("skill3").childNodes[1].src = "./img/void.png";
                document.getElementById("skill3").childNodes[3].innerHTML = "";
                selectid = id;
                range_display(0);
                state = 0;
                skill(0);
            }
            else {
                var chess = document.getElementById(id);
                if (state == 0) {//选择
                    document.getElementById("img").src = chess.img;
                    document.getElementById("name").innerHTML = chess.name;
                    document.getElementById("max_health").innerHTML = chess.max_health;
                    document.getElementById("health").innerHTML = chess.health;
                    document.getElementById("movement").innerHTML = chess.movement;
                    document.getElementById("max_movement").innerHTML = chess.max_movement;
                    document.getElementById("reflect").innerHTML = chess.reflect;
                    //document.getElementById("iid").innerHTML = chess.id;
                    //document.getElementById("fixedid").innerHTML = chess.fixedid;
                    document.getElementById("skill1").childNodes[1].src = chess.skill1_src;
                    document.getElementById("skill1").childNodes[3].innerHTML = chess.skill1_name;
                    document.getElementById("skill2").childNodes[1].src = chess.skill2_src;
                    document.getElementById("skill2").childNodes[3].innerHTML = chess.skill2_name;
                    document.getElementById("skill3").childNodes[1].src = chess.skill3_src;
                    document.getElementById("skill3").childNodes[3].innerHTML = chess.skill3_name;
                    selectid = id;
                    if (chess.class != 0) { controller(2); }
                }
                if (state == 1) {//技能选人
                    if (chess.class == 1 || chess.class == 2) {
                        if (detect_range(range, selectid, id) == 1) {
                            var input = document.getElementById("controller_page3").querySelector(".waiting");
                            input.style.backgroundColor = "rgb(0, 0, 0, 0)";
                            input.src = chess.img;
                            input.value = id;
                            input.removeAttribute("class");
                            state = 0;
                            range_display(0);
                        }
                    }
                }
                if (state == 2) {//技能选地
                    if (detect_range(range, selectid, id) == 1) {
                        if (chess.class != 0) {
                            var board = document.getElementById("board").children;
                            for (var i = 0; i < board.length; i++) {
                                if (board[i].class + 1) {
                                    if (board[i].x == chess.x && board[i].y == chess.y && board[i].class == 0) {
                                        chess = board[i];
                                        break;
                                    }
                                }
                            }
                        }
                        var input = document.getElementById("controller_page3").querySelector(".waiting");
                        input.style.backgroundColor = "rgb(0, 0, 0, 0)";
                        input.src = chess.img;
                        input.value = [chess.x, chess.y];
                        input.removeAttribute("class");
                        state = 0;
                        range_display(0);
                    }
                }
            }
        }
        function controller(page) {/*控制器*/
            control = page;
            if (control == 0) {
                document.getElementById("controller_page1").setAttribute("hidden", "hidden");
                document.getElementById("controller_page2").setAttribute("hidden", "hidden");
                document.getElementById("controller_page3").setAttribute("hidden", "hidden");
                document.getElementById("controller_button1").style.backgroundColor = "#393d49";
                document.getElementById("controller_button2").style.backgroundColor = "#393d49";
                document.getElementById("controller_button3").style.backgroundColor = "#393d49";
                skill(0);
                range_display(0);
            }
            if (control == 1) {
                document.getElementById("controller_page1").removeAttribute("hidden");
                document.getElementById("controller_page2").setAttribute("hidden", "hidden");
                document.getElementById("controller_page3").setAttribute("hidden", "hidden");
                document.getElementById("controller_button1").style.backgroundColor = "rgb(0, 255, 255)";
                document.getElementById("controller_button2").style.backgroundColor = "#393d49";
                document.getElementById("controller_button3").style.backgroundColor = "#393d49";
                skill(0);
                range_display(0);
            }
            if (control == 2) {
                document.getElementById("controller_page1").setAttribute("hidden", "hidden");
                document.getElementById("controller_page2").removeAttribute("hidden");
                document.getElementById("controller_page3").setAttribute("hidden", "hidden");
                document.getElementById("controller_button1").style.backgroundColor = "#393d49";
                document.getElementById("controller_button2").style.backgroundColor = "rgb(0, 255, 255)";
                document.getElementById("controller_button3").style.backgroundColor = "#393d49";
                skill(0);
                range_display(0);
            }
            if (control == 3) {
                document.getElementById("controller_page1").setAttribute("hidden", "hidden");
                document.getElementById("controller_page2").setAttribute("hidden", "hidden");
                document.getElementById("controller_page3").removeAttribute("hidden");
                document.getElementById("controller_button1").style.backgroundColor = "#393d49";
                document.getElementById("controller_button2").style.backgroundColor = "#393d49";
                document.getElementById("controller_button3").style.backgroundColor = "rgb(0, 255, 255)";
                range_display(0);
            }
        }
        function skill(skill) {/*控制器技能*/
            state = 0;
            var page = document.getElementById("controller_page3");
            if (skill == 0) {
                var newskill = document.createElement("skill");
                page.replaceChild(newskill, page.childNodes[1]);
                page.childNodes[3].childNodes[1].innerHTML = "";
                page.childNodes[5].childNodes[1].innerHTML = "";
            }
            else if (skill == 1) {
                if (document.getElementById(selectid).skill1_name == "无") {
                }
                else {
                    controller(3);
                    var newskill = document.getElementById(selectid).childNodes[skill - 1].cloneNode(true);
                    page.replaceChild(newskill, page.childNodes[1]);
                    page.childNodes[1].removeAttribute("hidden");
                    page.childNodes[3].childNodes[1].innerHTML = document.getElementById(selectid).skill1_cooling;
                    page.childNodes[3].childNodes[3].innerHTML = document.getElementById(selectid).skill1_max_cooling;
                    if (document.getElementById(selectid).skill1_class == 0) {
                        page.childNodes[5].childNodes[1].innerHTML = "被动";
                    }
                    if (document.getElementById(selectid).skill1_class == 1) {
                        page.childNodes[5].childNodes[1].innerHTML = "主动";
                    }
                }
            }
            else if (skill == 2) {
                if (document.getElementById(selectid).skill2_name == "无") {
                }
                else {
                    controller(3);
                    var newskill = document.getElementById(selectid).childNodes[skill - 1].cloneNode(true);
                    page.replaceChild(newskill, page.childNodes[1]);
                    page.childNodes[1].removeAttribute("hidden");
                    page.childNodes[3].childNodes[1].innerHTML = document.getElementById(selectid).skill2_cooling;
                    page.childNodes[3].childNodes[3].innerHTML = document.getElementById(selectid).skill2_max_cooling;
                    if (document.getElementById(selectid).skill2_class == 0) {
                        page.childNodes[5].childNodes[1].innerHTML = "被动";
                    }
                    if (document.getElementById(selectid).skill2_class == 1) {
                        page.childNodes[5].childNodes[1].innerHTML = "主动";
                    }
                }
            }
            else if (skill == 3) {
                if (document.getElementById(selectid).skill3_name == "无") {
                }
                else {
                    controller(3);
                    var newskill = document.getElementById(selectid).childNodes[skill - 1].cloneNode(true);
                    page.replaceChild(newskill, page.childNodes[1]);
                    page.childNodes[1].removeAttribute("hidden");
                    page.childNodes[3].childNodes[1].innerHTML = document.getElementById(selectid).skill3_cooling;
                    page.childNodes[3].childNodes[3].innerHTML = document.getElementById(selectid).skill3_max_cooling;
                    if (document.getElementById(selectid).skill3_class == 0) {
                        page.childNodes[5].childNodes[1].innerHTML = "被动";
                    }
                    if (document.getElementById(selectid).skill3_class == 1) {
                        page.childNodes[5].childNodes[1].innerHTML = "主动";
                    }
                }
            }
        }

        function anim1(x, y) {//受击动画300ms
            var opa = 0;
            var p1 = document.createElement("img");
            p1.id = pid;
            p1.src = "./img/particle1.png";
            p1.style.position = "absolute";
            p1.style.height = 25 + "px";
            p1.style.width = 25 + "px";
            p1.style.left = (x - 1) * 25 + "px";
            p1.style.bottom = (y - 1) * 25 + "px";
            p1.style.opacity = 0;
            p1.style.zIndex = 20;
            document.getElementById("board").appendChild(p1);
            var anim1_1 = setInterval(function () { opa += 0.033; document.getElementById(p1.id).style.opacity = opa; }, 10);
            setTimeout(function () { anim1_2() }, 150);
            function anim1_2() {
                clearInterval(anim1_1);
                var anim1_3 = setInterval(function () { opa -= 0.033; document.getElementById(p1.id).style.opacity = opa }, 10);
                setTimeout(function () { document.getElementById("board").removeChild(document.getElementById(p1.id)); }, 150);
            }
            pid++;
        }
        function anim2(x1, y1, x2, y2) {//远程攻击动画150ms
            var p1 = document.createElement("img");
            var x = (x1 - 1) * 25;
            var y = (y1 - 1) * 25;
            if (x2 - x1 == 0) {
                if (y2 - y1 >= 0) { var zita = 0; }
                else { var zita = 180; }
            }
            else if (x2 - x1 > 0) {
                var zita = 90 - Math.atan((y2 - y1) / (x2 - x1)) * 180 / Math.PI;
            }
            else if (x2 - x1 < 0) {
                var zita = 270 - Math.atan((y2 - y1) / (x2 - x1)) * 180 / Math.PI;
            }
            p1.id = pid;
            p1.src = "./img/particle3.png";
            p1.style.position = "absolute";
            p1.style.height = 25 + "px";
            p1.style.width = 25 + "px";
            p1.style.left = x + "px";
            p1.style.bottom = y + "px";
            p1.style.transform = "rotate(" + zita + "deg)"
            p1.style.zIndex = 20;
            document.getElementById("board").appendChild(p1);
            var anim2_1 = setInterval(function () { x += (x2 - x1) * 25 / 15; y += (y2 - y1) * 25 / 15; document.getElementById(p1.id).style.left = x + "px"; document.getElementById(p1.id).style.bottom = y + "px"; }, 10);
            setTimeout(function () { document.getElementById("board").removeChild(document.getElementById(p1.id)); }, 150);
            pid++;
        }
        function anim3(x, y, count) {//治疗粒子效果1000ms
            var p1 = document.createElement("img");
            var a = 0
            var x0 = (x - 1 + Math.random() / 2 - 0.25) * 25 + 5.7;
            var y0 = (y - 1 + Math.random() / 2 - 0.25) * 25 + 5.7;
            p1.id = pid;
            p1.src = "./img/particle5.png";
            p1.style.position = "absolute";
            p1.style.height = 10 + "px";
            p1.style.width = 10 + "px";
            p1.style.zIndex = 20;
            p1.style.left = x0 + "px";
            p1.style.bottom = y0 + "px";
            document.getElementById("board").appendChild(p1);
            setInterval(function () { a++; y0 += 3 / a; document.getElementById(p1.id).style.bottom = y0 + "px"; }, 10);
            setTimeout(function () { document.getElementById("board").removeChild(document.getElementById(p1.id)); }, 1000);
            pid++;
            if (count > 1) {
                anim3(x, y, count - 1);
            }
        }
        function anim4(x, y, count) {//伤害粒子效果1000ms
            var p1 = document.createElement("img");
            var a = 0
            var x0 = (x - 1 + Math.random() / 2 - 0.25) * 25 + 7.5;
            var y0 = (y - 1 + Math.random() / 2 - 0.25) * 25 + 7.5;
            p1.id = pid;
            p1.src = "./img/particle4.png";
            p1.style.position = "absolute";
            p1.style.height = 10 + "px";
            p1.style.width = 10 + "px";
            p1.style.opacity = 0.7;
            p1.style.zIndex = 20;
            p1.style.left = x0 + "px";
            p1.style.bottom = y0 + "px";
            document.getElementById("board").appendChild(p1);
            setInterval(function () { a++; y0 += 3 / a; document.getElementById(p1.id).style.bottom = y0 + "px"; }, 10);
            setTimeout(function () { document.getElementById("board").removeChild(document.getElementById(p1.id)); }, 1000);
            pid++;
            if (count > 1) {
                anim4(x, y, count - 1);
            }
        }
        function anim5(x, y) {//死亡特效3000ms
            var p1 = document.createElement("img");
            var opa = 1;
            p1.id = pid;
            p1.src = "./img/particle6.png";
            p1.style.position = "absolute";
            p1.style.height = 25 + "px";
            p1.style.width = 25 + "px";
            p1.style.left = (x - 1) * 25 + "px";
            p1.style.bottom = (y - 1) * 25 + "px";
            p1.style.zIndex = 20;
            document.getElementById("board").appendChild(p1);
            setInterval(function () { opa -= 0.00333; document.getElementById(p1.id).style.opacity = opa; }, 10);
            setTimeout(function () { document.getElementById("board").removeChild(document.getElementById(p1.id)) }, 3000);
            pid++;
        }
        function anim6(x, y) { }
        function anim7(x, y) { }
        function anim8(x, y) { }

        function chess3(x, y) {//小道行者
            var chess = document.createElement("chess0");
            var skill1 = document.createElement("skill");
            var skill2 = document.createElement("skill");
            var skill3 = document.createElement("skill");
            chess.id = id;

            //以下需改动
            chess.fixedid = 3;//1~1000人物1001~2000召唤物2001~3000地块
            chess.img = "./img/chess3.png";
            chess.name = "小道行者";
            chess.max_health = 10;
            chess.health = 10;
            chess.max_movement = 5;
            chess.movement = 5;
            chess.reflect = 10;
            skill1.innerHTML = '收到攻击时请求一次移动(不可躲避锁定人物的攻击)';
            skill2.innerHTML = '敌人朝自己移动时对其造成3点伤害';
            skill3.innerHTML = '敌人周围四格全有阻挡时，每回合造成1点伤害。';
            chess.skill1_src = "./img/skill0.png";//skill1
            chess.skill1_name = "闪避";
            chess.skill1_max_cooling = 1;
            chess.skill1_cooling = 0;
            chess.skill1_class = 0;//1主动0被动
            chess.skill2_src = "./img/skill0.png";//skill2
            chess.skill2_name = "不要过来啊";
            chess.skill2_max_cooling = 1;
            chess.skill2_cooling = 0;
            chess.skill2_class = 0;
            chess.skill3_src = "./img/skill0.png";//skill3
            chess.skill3_name = "窒息";
            chess.skill3_max_cooling = 0;
            chess.skill3_cooling = 0;
            chess.skill3_class = 0;
            chess.movefunction = function (id, dir, count, form, source, x, y) {
                var chess = document.getElementById(id);
                if (form == 0 && chess.fixedid == active_fixedid) {
                    if (dir == 1) { if (chess.direction == 1) { if (detect_resist(chess.x, chess.y + 1) == 0 && chess.movement >= 1) { chess.y += 1; chess.movement -= 1 } } else { chess.direction = 1; chess.style.transform = "rotate(0deg)"; } }
                    if (dir == 2) { if (chess.direction == 2) { if (detect_resist(chess.x + 1, chess.y) == 0 && chess.movement >= 1) { chess.x += 1; chess.movement -= 1 } } else { chess.direction = 2; chess.style.transform = "rotate(90deg)"; } }
                    if (dir == 3) { if (chess.direction == 3) { if (detect_resist(chess.x, chess.y - 1) == 0 && chess.movement >= 1) { chess.y -= 1; chess.movement -= 1 } } else { chess.direction = 3; chess.style.transform = "rotate(180deg)"; } }
                    if (dir == 4) { if (chess.direction == 4) { if (detect_resist(chess.x - 1, chess.y) == 0 && chess.movement >= 1) { chess.x -= 1; chess.movement -= 1 } } else { chess.direction = 4; chess.style.transform = "rotate(270deg)"; } }
                    selector(id);
                }
                else if (form == 1) {
                    if (dir == 0) {
                        var prex = chess.x;
                        var prey = chess.y;
                        if (count > 0) {
                            if (x > chess.x && detect_resist(chess.x - 1, chess.y) == 0) { prex -= 1; }
                            if (x < chess.x && detect_resist(chess.x + 1, chess.y) == 0) { prex += 1; }
                            if (y > chess.y && detect_resist(chess.x, chess.y - 1) == 0) { prey -= 1; }
                            if (y < chess.y && detect_resist(chess.x, chess.y + 1) == 0) { prey += 1; }
                            if (detect_resist(prex, prey) == 0) { setTimeout(function () { chess.x = prex; chess.y = prey; chess.style.left = (chess.x - 1) * 25 + "px"; chess.style.bottom = (chess.y - 1) * 25 + "px"; }, 100) }
                        }
                        else if (count < 0) {
                            if (x > chess.x && detect_resist(chess.x + 1, chess.y) == 0) { prex += 1; }
                            if (x < chess.x && detect_resist(chess.x - 1, chess.y) == 0) { prex -= 1; }
                            if (y > chess.y && detect_resist(chess.x, chess.y + 1) == 0) { prey += 1; }
                            if (y < chess.y && detect_resist(chess.x, chess.y - 1) == 0) { prey -= 1; }
                            if (detect_resist(prex, prey) == 0) { setTimeout(function () { chess.x = prex; chess.y = prey; chess.style.left = (chess.x - 1) * 25 + "px"; chess.style.bottom = (chess.y - 1) * 25 + "px"; }, 100) }
                        }
                    }
                    else {
                        if (dir == 1) { if (detect_resist(chess.x, chess.y + count) == 0) { chess.y += count } }
                        if (dir == 2) { if (detect_resist(chess.x + count, chess.y) == 0) { chess.x += count } }
                        if (dir == 3) { if (detect_resist(chess.x, chess.y - count) == 0) { chess.y -= count } }
                        if (dir == 4) { if (detect_resist(chess.x - count, chess.y) == 0) { chess.x -= count } }
                    }
                }
                chess.style.left = (chess.x - 1) * 25 + "px";
                chess.style.bottom = (chess.y - 1) * 25 + "px";
                if (form == 1 && count > 1 && dir == 0) { setTimeout(function () { chess.movefunction(id, dir, count - 1, form, source, x, y) }, 200); }
                if (form == 1 && count < -1 && dir == 0) { setTimeout(function () { chess.movefunction(id, dir, count + 1, form, source, x, y) }, 200); }
            }
            chess.hitfunction = function (id, hit_health, hit_max_health, hit_movement, hit_max_movement, hit_reflect, hit_class, hit_target, source, x, y) {
                var chess = document.getElementById(id);
                chess.health += hit_health * chess.hit_multiply;
                if (hit_health < 0) {
                    chess.health += chess.hit_add;
                }
                chess.max_health += hit_max_health;
                chess.movement += hit_movement;
                chess.max_movement += hit_max_movement;
                chess.reflect += hit_reflect;
                if (chess.health > chess.max_health) { chess.health = chess.max_health; }
                if (chess.movement > chess.max_movement) { chess.movement = chess.max_movement; }
                anim1(chess.x, chess.y);
                if (chess.health <= 0) { document.getElementById("board").removeChild(chess); }
            }
            chess.skillfunction = function (id) {
                var chess = document.getElementById("board").children;//窒息
                var self = document.getElementById(id);
                if (round > self.data[0]) {
                    for (var i = 1; i <= 1000; i++) {
                        self.data[i] = 0;
                    }
                    self.data[0] = round;
                }
                for (var i = 0; i < chess.length; i++) {
                    var x = chess[i].x;
                    var y = chess[i].y;
                    if (chess[i].class != 0 && detect_resist(x, y - 1) == 1 && detect_resist(x, y + 1) == 1 && detect_resist(x + 1, y) == 1 && detect_resist(x - 1, y) == 1 && self.data[chess[i].id] == 0) {
                        self.data[chess[i].id] = 1;
                        chess[i].hitfunction(chess[i].id, -1, 0, 0, 0, 0, 0, 0, id, x, y);
                    }
                }
            }
            chess.resist = 1;//1阻挡0不阻挡
            chess.class = 1;//0地块,1人物,2召唤物
            chess.style.zIndex = 5;//地块0,人物5,动画粒子等20+
            chess.data = new Array(1000);//数据
            chess.data[0] = 0;
            //tag

            chess.attack_add = 0;
            chess.attack_multiply = 1;
            chess.hit_add = 0;
            chess.hit_multiply = 1;
            skill1.setAttribute("hidden", "hidden")
            skill2.setAttribute("hidden", "hidden")
            skill3.setAttribute("hidden", "hidden")
            chess.appendChild(skill1);
            chess.appendChild(skill2);
            chess.appendChild(skill3);
            chess.x = x;
            chess.y = y;
            chess.direction = 1;
            chess.skillable = 1;
            chess.movable = 1;
            chess.style.backgroundImage = "url(" + chess.img + ")";
            chess.style.left = (chess.x - 1) * 25 + "px";
            chess.style.bottom = (chess.y - 1) * 25 + "px";
            chess.setAttribute("onclick", "selector(id)")
            document.getElementById("board").appendChild(chess);
            id++;
            overall_skill();
        }
    </script>
    <script src="./character/chess1.js">//勇者</script>
    <script src="./character/chess2.js">//</script>
    <script src="./character/chess3.js">//</script>
    <script src="./character/chess4.js">//</script>
    <script src="./character/chess5.js">//无人机操控者</script>
    <script src="./character/chess6.js">//红王</script>
    <script src="./character/chess7.js">//</script>
    <script src="./character/chess8.js">//</script>
    <script src="./character/chess1005.js">//战斗无人机</script>
    <script src="./character/chess1006.js">//救治无人机</script>
    <script src="./character/chess2001.js">//基础地块</script>
    <style>
        chess0 {
            display: block;
            position: absolute;
            width: 25px;
            height: 25px;
            background-size: 25px;
        }

        p {
            margin: 0px;
        }
    </style>
</head>

<body style="margin:0px">
    <div
        style="display: flex; flex-direction: row; height: 50px;background-color: #393d49;background: url(img/back1.png) no-repeat;background-size:100% 100px;">
        <p style="background-color: black;color: white;width: 200px;font-size:30px;padding: 5px;">回合: <b
                id="round">1</br></p>
        <p id="next"
            style="position: absolute;right: 0px;height: 50px;width: 50px;cursor: pointer;background-color: white;color: rgb(1,1,1,0.5);"
            onclick="next_act()">
            *结束<br>行动*</p>
    </div>
    <!--棋盘-->
    <div id="board" style="position:relative;height:400px;">

    </div>
    <div hidden id="overall_skill"></div>
    <script>//生成地块
        for (var i = 1; i <= 16; i++) {
            for (var j = 1; j <= 16; j++) {
                chess2001(i, j);
            }
        }
    </script>
    <div style="display: flex;">
        <!--目标选择器-->
        <div id="selector" style="background-image:url(img/back2.png) ;width:200px;height: 200px;">
            <img id="img" src="./img/void.png" width="100px" height="100px" alt=" "
                style="position: absolute;left: 100px;">
            <p style="display: inline;">目标:</p><b id="name" style="display: inline"></b><br>
            <p style="display: inline;">血量:</p><b id="health" style="display: inline"></b><b>/</b><b id="max_health"
                style="display: inline"></b><br>
            <p style="display: inline;">移动:</p><b id="movement" style="display: inline"></b><b>/</b><b id="max_movement"
                style="display: inline"></b><br>
            <p style="display: inline;">反应:</p><b id="reflect" style="display: inline"></b><br>
            <!--<p style="display: inline;">id:</p><b id="iid" style="display: inline"></b><br>
            <p style="display: inline;">fixedid:</p><b id="fixedid" style="display: inline"></b><br>-->
            <!--skill-->
            <p>技能:</p>
            <div style="display:flex;flex-direction: row;height: 66.6px;">
                <div id="skill1" style="width: 66.6px;">
                    <img src="./img/void.png" width="50px" height="50px" onclick="skill(1)" style="cursor: pointer;">
                    <p style="font-size:10px;"></p>
                </div>
                <div id="skill2" style="width: 66.6px;">
                    <img src="./img/void.png" width="50px" height="50px" onclick="skill(2)" style="cursor: pointer;">
                    <p style="font-size:10px;"></p>
                </div>
                <div id="skill3" style="width: 66.6px;">
                    <img src="./img/void.png" width="50px" height="50px" onclick="skill(3)" style="cursor: pointer;">
                    <p style="font-size:10px;"></p>
                </div>
            </div>
        </div>
        <div style="display: flex;flex-direction: column;">
            <!--控制区索引-->
            <div style="display: flex;flex-direction: row;height:30px;background-color: #393d49;width:212.5px;">
                <button id="controller_button1" onclick="controller(1)"
                    style="background-color: #393d49;border-radius: 0px;height:30px;width:30px;border: 0px;">生</button>
                <button id="controller_button2" onclick="controller(2)"
                    style="background-color: #393d49;border-radius: 0px;height:30px;width:30px;border: 0px;">移</button>
                <button id="controller_button3" onclick="controller(3)"
                    style="background-color: #393d49;border-radius: 0px;height:30px;width:30px;border: 0px;">技</button>
            </div>
            <!--控制区-->
            <div style="background-color: aqua;height:170px;position: relative;">
                <!--1生-->
                <div id="controller_page1" hidden>
                    <!--<button onclick="chess1(16,1)">勇者</button>
                    <button onclick="chess2001(5,5)">地块</button>
                    <button onclick="chess3(1,1)">小道行者</button>-->
                    <button onclick="chess5(16,6)">无人机操控者</button>
                    <button onclick="chess6(1,6)">红王</button>
                </div>
                <!--2移-->
                <div id="controller_page2" hidden
                    style="position: absolute;background-color: red;height: 50px;width: 50px;left:81.25px;top: 60px;">
                    <p onclick="document.getElementById(selectid).movefunction(selectid,1,1,0,0,0,0)"
                        style="transform:rotate(0deg);font-size:50px;background-color:rgb(1,1,1,0.3);position: absolute;left:0px;top: -66px;cursor: pointer;">
                        ▲</p>
                    <p onclick="document.getElementById(selectid).movefunction(selectid,2,1,0,0,0,0)"
                        style="transform: rotate(90deg);font-size:50px;background-color:rgb(1,1,1,0.3);position: absolute;left:59px;top: -8px;cursor: pointer;">
                        ▲</p>
                    <p onclick="document.getElementById(selectid).movefunction(selectid,3,1,0,0,0,0)"
                        style="transform: rotate(180deg);font-size:50px;background-color:rgb(1,1,1,0.3);position: absolute;left:0px;top: 50px;cursor: pointer;">
                        ▲</p>
                    <p onclick="document.getElementById(selectid).movefunction(selectid,4,1,0,0,0,0)"
                        style="transform: rotate(270deg);font-size:50px;background-color:rgb(1,1,1,0.3);position: absolute;left:-58px;top:-8px;cursor: pointer;">
                        ▲</p>
                </div>
                <!--3技-->
                <div id="controller_page3" hidden>
                    <skill></skill>
                    <p style="position: absolute;bottom: 20px;">冷却：<b></b>/<b></b>(回合)</p>
                    <p style="position: absolute;bottom: 0px;">类型：<b></b></p>

                </div>
            </div>
        </div>
    </div>
</body>

</html>