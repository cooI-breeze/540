<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>game</title>
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <script src="./jQuery3-7.js"></script>
    <script src="./jquery_ui.js"></script>
    <script>
        var round = 0;
        var id = 1;/*动态id*/
        var pid = 10000;/*特效动态id*/
        var state = 0;/*0正常选择,1等待输入对象人物,2等待输入坐标,3范围演示，4生人物*/;
        var selectid = 0;/*选择目标*/
        var control = 1;/*控制区状态*/
        var range = 0;//选择范围
        var active_fixedid = 2;
        var last_reflect = 9999;
        var acted_fixedid = new Array(10000);
        var setting = [0, 0, 0, 1, 1]//0空 1地板0随机1基础2石质3草地  2地图0随机  3背景音乐  4游戏音效
        var creation = 0;//生成人物
        var turn = 0;//是否转向
        var music_on = 0;//用来初始化音乐

        function next_act() {//下一行动
            if (round == 0) {
                var board = document.getElementById("board").children;
                round += 1;
                document.getElementById("round").innerHTML = round;
                document.getElementById('round_start_p').innerHTML = '第' + round + '回合开始';
                document.getElementById("round_start").classList.remove('round_fade');
                document.getElementById("round_start").classList.add('round_emerge');
                setTimeout(function () { document.getElementById("round_start").classList.remove('round_emerge'); document.getElementById("round_start").classList.add('round'); }, 20);
                setTimeout(function () { document.getElementById("round_start").classList.remove('round'); document.getElementById("round_start").classList.add('round_fade'); }, 820);
                next_act();
            }
            else {
                var chess = document.getElementById("board").children;
                var active_reflect = -1;
                var active_movement = -1;
                var active_id = id + 1;
                var act_find = 0;
                active_fixedid = -1;
                for (var i = 0; i < chess.length; i++) {//找
                    if (chess[i].class != 0 && acted_fixedid[chess[i].fixedid] != 1 && chess[i].reflect + chess[i].effect_sum[8] <= last_reflect && chess[i].reflect + chess[i].effect_sum[8] >= 0) {//不是地块，未行动过，比上一个行动的人的反应小，反应大于等于0
                        if (chess[i].fixedid == active_fixedid) continue;
                        if (chess[i].reflect + chess[i].effect_sum[8] > active_reflect) {
                            active_reflect = chess[i].reflect + chess[i].effect_sum[8];
                            active_movement = chess[i].max_movement;
                            active_id = chess[i].id;
                            active_fixedid = chess[i].fixedid;
                            act_find = 1;
                        }
                        else if (chess[i].reflect + chess[i].effect_sum[8] == active_reflect) {
                            if (chess[i].movement > active_movement) {
                                active_reflect = chess[i].reflect + chess[i].effect_sum[8];
                                active_movement = chess[i].max_movement;
                                active_id = chess[i].id;
                                active_fixedid = chess[i].fixedid;
                                act_find = 1;
                            }
                            else if (chess[i].movement == active_movement) {
                                if (chess[i].id < active_id) {
                                    active_reflect = chess[i].reflect + chess[i].effect_sum[8];
                                    active_movement = chess[i].max_movement;
                                    active_id = chess[i].id;
                                    active_fixedid = chess[i].fixedid;
                                    act_find = 1;
                                }
                            }
                        }
                    }
                }
                selector(0);
                controller(0);
                if (act_find == 0) {//没找到 进下回合
                    round += 1;
                    last_reflect = 9999;
                    for (var i = 0; i < chess.length; i++) {
                        if (chess[i].class != 0) {//回移动、减冷却、减特殊效果持续时间
                            chess[i].movement = chess[i].max_movement + chess[i].effect_sum[9];
                            if (chess[i].skill1_cooling > 0) { chess[i].skill1_cooling -= 1; }
                            if (chess[i].skill2_cooling > 0) { chess[i].skill2_cooling -= 1; }
                            if (chess[i].skill3_cooling > 0) { chess[i].skill3_cooling -= 1; }
                            if (chess[i].enemy == 1) {
                                chess[i].data[0] = 0;//行动未完成
                            }
                            if (chess[i].effect_sum[5] > 0) {//火毒
                                hit(chess[i].id, -chess[i].effect_sum[5], 0, 0, 0, 0);
                            }
                        }
                    }
                    acted_fixedid = new Array(10000);
                    var x = Math.ceil(Math.random() * 16);
                    var y = Math.ceil(Math.random() * 16);
                    chess1010(x, y);
                    var x = Math.ceil(Math.random() * 16);
                    var y = Math.ceil(Math.random() * 16);
                    chess1010(x, y);
                    var x = Math.ceil(Math.random() * 16);
                    var y = Math.ceil(Math.random() * 16);
                    chess1010(x, y);
                    document.getElementById("round").innerHTML = round;
                    //右上角按钮动画
                    document.getElementById("next").classList.add('fade');
                    setTimeout(function () { document.getElementById("next").src = ' '; document.getElementById("next").classList.remove('fade'); document.getElementById("next").classList.add('emerge'); }, 700);
                    setTimeout(function () { document.getElementById("next").classList.remove('emerge'); }, 730);
                    //回合结束动画
                    document.getElementById('round_over_p').innerHTML = '第' + (round - 1) + '回合结束';
                    document.getElementById("round_over").classList.remove('round_fade');
                    document.getElementById("round_over").classList.add('round_emerge');
                    setTimeout(function () { document.getElementById("round_over").classList.remove('round_emerge'); document.getElementById("round_over").classList.add('round'); }, 20);
                    setTimeout(function () { document.getElementById("round_over").classList.remove('round'); document.getElementById("round_over").classList.add('round_fade'); }, 820);
                    //回合开始动画
                    document.getElementById('round_start_p').innerHTML = '第' + round + '回合开始';
                    setTimeout(function () {
                        next_act();
                        document.getElementById("round_start").classList.remove('round_fade');
                        document.getElementById("round_start").classList.add('round_emerge');
                        setTimeout(function () { document.getElementById("round_start").classList.remove('round_emerge'); document.getElementById("round_start").classList.add('round'); }, 20);
                        setTimeout(function () { document.getElementById("round_start").classList.remove('round'); document.getElementById("round_start").classList.add('round_fade'); }, 820);
                    }, 1620)
                }
                else {//找到了
                    document.getElementById("next").classList.add('fade');
                    setTimeout(function () { document.getElementById("next").src = document.getElementById(active_id).img; document.getElementById("next").classList.remove('fade'); document.getElementById("next").classList.add('emerge'); }, 700);
                    setTimeout(function () { document.getElementById("next").classList.remove('emerge'); }, 720);
                    last_reflect = document.getElementById(active_id).reflect + document.getElementById(active_id).effect_sum[8];
                    acted_fixedid[active_fixedid] = 1;
                    var num = 0;
                    for (var i = 0; i < chess.length; i++) {//找可行动人数量
                        if (chess[i].fixedid == active_fixedid) { num++; }
                    }
                    if (num == 1) {//自动选择
                        selector(active_id, 1);
                    }
                    for (var i = 0; i < chess.length; i++) {
                        if (chess[i].effect[0] > 1) {//特殊效果计算
                            for (var j = 1; j < chess[i].effect[0]; j++) {
                                //判断时间点
                                if (chess[i].effect[j][3][0] > round || (chess[i].effect[j][3][0] == round && (chess[i].effect[j][3][1] < active_reflect || (chess[i].effect[j][3][1] == active_reflect && (chess[i].effect[j][3][2] < active_movement || (chess[i].effect[j][3][2] == active_movement && (chess[i].effect[j][3][3] > active_id || chess[i].effect[j][3][4] == active_fixedid))))))) {
                                    chess[i].effect[j][3][0]++;
                                    chess[i].effect[j][2]--;
                                    if (chess[i].effect[j][2] == 0) {
                                        chess[i].effect[0]--;
                                        for (var k = j; k < chess[i].effect[0]; k++) {
                                            chess[i].effect[k] = chess[i].effect[k + 1];
                                        }
                                        j--;
                                    }
                                }
                                else {
                                    continue;
                                }
                            }
                            //重新计算
                            for (var j = 1; j <= 16; j++) {
                                chess[i].effect_sum[j] = 0;
                            }
                            for (var j = 1; j < chess[i].effect[0]; j++) {
                                if (chess[i].effect[j][0] == 10) {
                                    chess[i].effect_sum[14] = 1;
                                }
                            }
                            if (chess[i].effect_sum[14] == 0) {
                                for (var j = 1; j < chess[i].effect[0]; j++) {
                                    if (chess[i].effect[j][0] == 1) {
                                        chess[i].effect_sum[1] -= chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 2) {
                                        chess[i].effect_sum[1] += chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 3) {
                                        chess[i].effect_sum[2] = 1;
                                    } else if (chess[i].effect[j][0] == 5) {
                                        chess[i].effect_sum[3] = 1;
                                    } else if (chess[i].effect[j][0] == 7) {
                                        chess[i].effect_sum[4] += chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 8) {
                                        chess[i].effect_sum[5] += chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 9) {
                                        chess[i].effect_sum[6] = 1;
                                    } else if (chess[i].effect[j][0] == 11) {
                                        chess[i].effect_sum[7] += chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 12) {
                                        chess[i].effect_sum[7] -= chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 13) {
                                        chess[i].effect_sum[8] += chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 14) {
                                        chess[i].effect_sum[8] -= chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 15) {
                                        chess[i].effect_sum[9] += chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 16) {
                                        chess[i].effect_sum[9] -= chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 17) {
                                        chess[i].effect_sum[10] += chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 18) {
                                        chess[i].effect_sum[10] -= chess[i].effect[j][1];
                                    } else if (chess[i].effect[j][0] == 4) {
                                        chess[i].effect_sum[11] = 1;
                                    } else if (chess[i].effect[j][0] == 6) {
                                        chess[i].effect_sum[12] = 1;
                                    } else if (chess[i].effect[j][0] == 19) {
                                        chess[i].effect_sum[13] = 1;
                                    } else if (chess[i].effect[j][0] == 20) {
                                        chess[i].effect_sum[15] = 1;
                                    }
                                }
                            }
                        }
                    }
                }
                overall_skill();
            }
        }
        function overall_skill() {//全局技能模块
            var chess = document.getElementById("board").children;
            var skill = document.getElementById("overall_skill").children;
            for (var i = 0; i < chess.length; i++) {
                if (chess[i].class + 1) { chess[i].skillfunction(chess[i].id); }
            }
            for (var i = 0; i < skill.length; i++) {//不依赖某人物的全局技能
                skill[i].skillfunction(skill[i].id);
            }
        }

        function input(form, id, r) {//1人物2坐标3范围演示 
            var chess = document.getElementById(selectid);
            if (chess.fixedid == active_fixedid || form == 3) {
                if (state == 0) {
                    state = form;
                    range = r;
                    var input = document.getElementById("controller_page3").querySelector("#" + id);
                    input.src = "./img/void.png";
                    input.value = new Number;
                    input.style.backgroundColor = "rgb(76, 244, 10,0.5)";
                    input.setAttribute("class", "waiting");
                    range_display(1);
                }
                else if (state != 0) {
                    state = 0;
                    range = 0;
                    var wait = document.getElementsByClassName('waiting');
                    for (var i = 0; i < wait.length; i++) {
                        wait[i].style.backgroundColor = " rgb(0,0,0,0)";
                        wait[i].src = "./img/choose.png";
                        wait[i].removeAttribute("class");
                    }
                    range_display(0);
                }
            }
        }
        function range_display(i) {
            if (i == 0) {
                if (document.getElementsByClassName("range_display")[0]) {
                    document.getElementById("board").removeChild(document.getElementsByClassName("range_display")[0]);
                }
            }
            if (i == 1) {
                var rimg = document.createElement("img");
                var chess = document.getElementById(selectid);
                rimg.src = "./img/range" + range + ".png";
                rimg.style.position = "absolute";
                rimg.style.height = 25 * 31 + "px";
                rimg.style.width = 25 * 31 + "px";
                rimg.style.left = (chess.x - 16) * 25 + "px";
                rimg.style.bottom = (chess.y - 16) * 25 + "px";
                rimg.style.zIndex = 120;
                rimg.style.pointerEvents = "none";
                rimg.setAttribute("class", "range_display")
                document.getElementById("board").appendChild(rimg);
            }
        }

        function detect_resist(x, y) {//检测阻挡 阻挡/无地块1 空地块0
            var chess = document.getElementById("board").children;
            var bool = 0;
            for (var i = 0; i < chess.length; i++) {
                if (chess[i].x == x && chess[i].y == y && chess[i].resist == 1) {//有阻挡
                    return 1;
                }
                else if (chess[i].x == x && chess[i].y == y && chess[i].class == 0) {//有地块
                    bool = 1;
                }
            }
            if (bool == 1) {
                return 0;
            }
            else {
                return 1;
            }
        }
        function detect_range(r, id1, id2) {//范围检测
            var x0 = document.getElementById(id1).x;
            var y0 = document.getElementById(id1).y;
            var x1 = document.getElementById(id2).x;
            var y1 = document.getElementById(id2).y;
            var abs_diff = Math.abs(x1 - x0) + Math.abs(y1 - y0);

            if (r >= 1 && r <= 10) { // 曼哈顿距离小于等于r!=0
                if (abs_diff <= r && abs_diff != 0) {
                    return 1;
                }
                return 0;
            } else if (r === 11) { // 直线
                if ((x0 === x1 || y0 === y1) && abs_diff != 0) {
                    return 1;
                }
                return 0;
            } else if (r === 12) { // 全屏
                return 1;
            } else if (r === 15) { // 周围8格
                if (Math.abs(x1 - x0) <= 1 && Math.abs(y1 - y0) <= 1) {
                    return 1;
                }
                return 0;
            } else if (r == 16) {
                if ((x0 === x1 || y0 === y1) && abs_diff >= 4) {
                    return 1;
                }
                return 0;
            }
        }
        function route(x1, y1, x2, y2, move, damage, hurt, cha) {//计算路劲 起始xy 目标xy 移动 伤害 是否攻击友方(性格) 寻路模块 
            var queue = new Array(300);
            var qindex = 1;
            var boardsum = new Array(17);
            var board = document.getElementById('board').children;
            for (var i = 1; i <= 290; i++) {
                queue[i] = [0, 0];
            }
            for (var i = 1; i <= 16; i++) {
                boardsum[i] = new Array(17);
                for (var j = 1; j <= 16; j++) {
                    boardsum[i][j] = [9999, 0, 0];//boardsum[i][j][0]所需步数[1]第一步方向[2]停留数 
                }
            }
            queue[1] = [x1, y1];
            boardsum[x1][y1] = [0, 0, 0];
            while (1) {
                var x = queue[1][0];//取出
                var y = queue[1][1];
                for (var i = 1; i < qindex; i++) {
                    queue[i] = queue[i + 1];
                }
                if (boardsum[x][y][2] == 0) {
                    qindex--;
                } else {
                    boardsum[x][y][2]--;
                    queue[qindex] = [x, y];
                    continue;
                }
                if (x == x2 && y == y2) {//到终点 
                    break;
                }
                var next = [[0, 1, 1], [1, 0, 2], [0, -1, 3], [-1, 0, 4]];
                for (var i = 0; i <= 3; i++) {//走四个方向  
                    var nx = x + next[i][0];
                    var ny = y + next[i][1];
                    if (ny < 1 || ny > 16 || nx < 1 || nx > 16) {//出边界
                        continue;
                    }
                    if (boardsum[nx][ny][0] == 9999) {//更新 
                        if (detect_resist(nx, ny) == 0) {//不是障碍
                            boardsum[nx][ny][0] = boardsum[x][y][0] + 1;
                        } else {//是障碍
                            for (var j = 1; j < board.length; j++) {
                                if (board[j].x == nx && board[j].y == ny && board[j].class != 0) {
                                    var health = board[j].health;
                                    break;
                                }
                            }
                            var extra_move = Math.ceil(health / damage) * move;
                            boardsum[nx][ny][0] = boardsum[x][y][0] + extra_move + 1;
                            boardsum[nx][ny][2] = extra_move;
                        }
                        if (x == x1 && y == y1) {//是出发点
                            boardsum[nx][ny][1] = next[i][2]//确定方向 
                        } else {//不是出发点
                            boardsum[nx][ny][1] = boardsum[x][y][1];//继承方向
                        }
                        queue[qindex + 1] = [nx, ny];
                        qindex++;
                    }
                }
            }
            return ([boardsum[x2][y2][0], boardsum[x2][y2][1]]);//返回[0]所需步数[1]第一步方向
        }
        function selector(id, force) {//选择器，id 是否强制选择(强制为了防止选到下面一层去)     
            if (id == 0) {//选择器0
                document.getElementById("img").src = "./img/void.png";
                document.getElementById("name").innerHTML = "";
                document.getElementById("max_health").innerHTML = "";
                document.getElementById("health").innerHTML = "";
                document.getElementById("movement").innerHTML = "";
                document.getElementById("max_movement").innerHTML = "";
                document.getElementById("health_modification").innerHTML = "";
                document.getElementById("movement_modification").innerHTML = "";
                document.getElementById("reflect_modification").innerHTML = "";
                document.getElementById("reflect").innerHTML = "";
                document.getElementById("skill1").childNodes[1].src = "./img/void.png";
                document.getElementById("skill1").childNodes[3].innerHTML = "";
                document.getElementById("skill2").childNodes[1].src = "./img/void.png";
                document.getElementById("skill2").childNodes[3].innerHTML = "";
                document.getElementById("skill3").childNodes[1].src = "./img/void.png";
                document.getElementById("skill3").childNodes[3].innerHTML = "";
                document.getElementById('effect_board').innerHTML = "";
                selectid = id;
                range_display(0);
                state = 0;
                skill(0);
            }
            else {
                var chess = document.getElementById(id);
                var effect_intro = [0, '防御：受到的伤害减少', '脆弱：受到的伤害增加', '昏厥：无法行动', '坚毅：无法被昏厥', '束缚：无法移动', '大型：无法被束缚', '泥沼：移动时消耗的移动增加', '火毒：每回合结束受到', '超重：无法被推拉', '免疫：免疫其余所有特殊效果', '攻击+：攻击增加', '攻击-：攻击减少', '反应+：反应增加', '反应-：反应减少', '移动+：最大移动增加', '移动-：最大移动减少', '生命+:最大生命增加', '生命-：最大生命', '缴械：无法释放技能', '武装：无法被缴械'];
                if (state == 0) {//选择
                    if (selectid == 0 || force == 1 || !document.getElementById(selectid)) {//强制选择或前人物找不到（已死亡）
                        document.getElementById("img").src = chess.img;
                        document.getElementById("name").innerHTML = chess.name;
                        document.getElementById("max_health").innerHTML = chess.max_health;
                        if (chess.effect_sum[10] > 0) {
                            document.getElementById("health_modification").innerHTML = '+' + chess.effect_sum[10];
                            document.getElementById("health_modification").style.color = '#00cc00';
                        } else if (chess.effect_sum[10] < 0) {
                            document.getElementById("health_modification").innerHTML = chess.effect_sum[10];
                            document.getElementById("health_modification").style.color = 'red';
                        } else { document.getElementById("health_modification").innerHTML = "" }
                        document.getElementById("health").innerHTML = chess.health;
                        document.getElementById("movement").innerHTML = chess.movement;
                        document.getElementById("max_movement").innerHTML = chess.max_movement;
                        if (chess.effect_sum[9] > 0) {
                            document.getElementById("movement_modification").innerHTML = '+' + chess.effect_sum[9];
                            document.getElementById("movement_modification").style.color = '#00cc00';
                        } else if (chess.effect_sum[9] < 0) {
                            document.getElementById("movement_modification").innerHTML = chess.effect_sum[9];
                            document.getElementById("movement_modification").style.color = 'red';
                        } else { document.getElementById("movement_modification").innerHTML = "" }
                        document.getElementById("reflect").innerHTML = chess.reflect;
                        if (chess.effect_sum[8] > 0) {
                            document.getElementById("reflect_modification").innerHTML = '(+' + chess.effect_sum[8] + ')';
                            document.getElementById("reflect_modification").style.color = '#00cc00';
                        } else if (chess.effect_sum[8] < 0) {
                            document.getElementById("reflect_modification").innerHTML = '(' + chess.effect_sum[8] + ')';
                            document.getElementById("reflect_modification").style.color = 'red';
                        } else { document.getElementById("reflect_modification").innerHTML = "" }
                        //document.getElementById("iid").innerHTML = chess.id;
                        //document.getElementById("fixedid").innerHTML = chess.fixedid;
                        document.getElementById("skill1").childNodes[1].src = chess.skill1_src;
                        document.getElementById("skill1").childNodes[3].innerHTML = chess.skill1_name;
                        document.getElementById("skill2").childNodes[1].src = chess.skill2_src;
                        document.getElementById("skill2").childNodes[3].innerHTML = chess.skill2_name;
                        document.getElementById("skill3").childNodes[1].src = chess.skill3_src;
                        document.getElementById("skill3").childNodes[3].innerHTML = chess.skill3_name;
                        document.getElementById('effect_board').innerHTML = "";
                        if (chess.effect[0] > 1) {
                            for (var i = 1; i < chess.effect[0]; i++) {
                                var div = document.createElement('div');
                                var img = document.createElement('img');
                                var p = document.createElement('p');
                                var kind = chess.effect[i][0];
                                var src = './img/effect' + kind + '.png';
                                img.src = src;
                                img.style.width = '25px';
                                img.style.height = '25px';
                                img.style.opacity = 0.7;
                                p.innerHTML = effect_intro[chess.effect[i][0]];
                                if (kind == 1 || kind == 2 || kind == 7 || kind == 8 || kind == 11 || kind == 12 || kind == 13 || kind == 14 || kind == 15 || kind == 16 || kind == 17 || kind == 18) {
                                    p.innerHTML += chess.effect[i][1];
                                }
                                if (kind == 8) { p.innerHTML += '点伤害' }
                                p.innerHTML += ",持续" + chess.effect[i][2] + '回合';
                                p.style.opacity = 0.7;
                                div.style.display = 'flex';
                                div.appendChild(img);
                                div.appendChild(p);
                                document.getElementById('effect_board').appendChild(div);
                            }
                        }
                        selectid = id;
                        if (chess.class != 0) { controller(2); }
                    }
                    //不强制选择
                    else if (document.getElementById(id).x == document.getElementById(selectid).x && document.getElementById(id).y == document.getElementById(selectid).y) {//选择与已选坐标相同
                        var next = 0;
                        var next_z = -100;
                        var board = document.getElementById("board").children;
                        for (var i = 0; i < board.length; i++) {
                            if (board[i].x == document.getElementById(id).x && board[i].y == document.getElementById(id).y && board[i].style.zIndex < document.getElementById(selectid).style.zIndex && board[i].style.zIndex > next_z) {
                                next = board[i].id;
                                next_z = document.getElementById(next).style.zIndex;
                            }
                        }
                        if (next != 0) { id = next; }
                        selector(id, 1);
                    }
                    else {//选择与已选坐标不同
                        selector(id, 1);
                    }
                }
                if (state == 1) {//技能选人
                    if (chess.class != 0) {
                        if (detect_range(range, selectid, id) == 1) {
                            var input = document.getElementById("controller_page3").querySelector(".waiting");
                            input.style.backgroundColor = "rgb(0, 0, 0, 0)";
                            input.src = chess.img;
                            input.value = id;
                            input.removeAttribute("class");
                            state = 0;
                            range_display(0);
                        }
                    }
                }
                if (state == 2) {//技能选地
                    if (detect_range(range, selectid, id) == 1) {
                        if (chess.class != 0) {
                            var board = document.getElementById("board").children;
                            for (var i = 0; i < board.length; i++) {
                                if (board[i].class + 1) {
                                    if (board[i].x == chess.x && board[i].y == chess.y && board[i].class == 0) {
                                        chess = board[i];
                                        break;
                                    }
                                }
                            }
                        }
                        var input = document.getElementById("controller_page3").querySelector(".waiting");
                        input.style.backgroundColor = "rgb(0, 0, 0, 0)";
                        input.src = chess.img;
                        input.value = [chess.x, chess.y];
                        input.removeAttribute("class");
                        state = 0;
                        range_display(0);
                    }
                }
                if (state == 4) {//生人
                    var x = chess.x;
                    var y = chess.y;
                    if (creation == 1) { chess1(x, y); }
                    if (creation == 2) { chess2(x, y); }
                    if (creation == 4) { chess4(x, y); }
                    if (creation == 5) { chess5(x, y); }
                    if (creation == 6) { chess6(x, y); }
                    if (creation == 7) { chess7(x, y); }
                    if (creation == 8) { chess8(x, y); }
                    if (creation == 9) { chess9(x, y); }
                    if (creation == 1010) { chess1010(x, y); }
                    state = 0;
                    creation = 0;
                    if (document.querySelector('.born')) {
                        document.querySelector('.born').classList.remove('born');
                    }
                }
            }
        }
        function controller(page) {/*控制器*/
            control = page;
            if (control == 0) {
                document.getElementById("controller_page1").setAttribute("hidden", "hidden");
                document.getElementById("controller_page2").setAttribute("hidden", "hidden");
                document.getElementById("controller_page3").setAttribute("hidden", "hidden");
                document.getElementById("controller_button1").style.backgroundColor = "#555b6d";
                document.getElementById("controller_button2").style.backgroundColor = "#555b6d";
                document.getElementById("controller_button3").style.backgroundColor = "#555b6d";
                skill(0);
                range_display(0);
            }
            if (control == 1) {
                document.getElementById("controller_page1").removeAttribute("hidden");
                document.getElementById("controller_page2").setAttribute("hidden", "hidden");
                document.getElementById("controller_page3").setAttribute("hidden", "hidden");
                document.getElementById("controller_button1").style.backgroundColor = "rgb(0, 255, 255)";
                document.getElementById("controller_button2").style.backgroundColor = "#555b6d";
                document.getElementById("controller_button3").style.backgroundColor = "#555b6d";
                skill(0);
                range_display(0);
            }
            if (control == 2) {
                document.getElementById("controller_page1").setAttribute("hidden", "hidden");
                document.getElementById("controller_page2").removeAttribute("hidden");
                document.getElementById("controller_page3").setAttribute("hidden", "hidden");
                document.getElementById("controller_button1").style.backgroundColor = "#555b6d";
                document.getElementById("controller_button2").style.backgroundColor = "rgb(0, 255, 255)";
                document.getElementById("controller_button3").style.backgroundColor = "#555b6d";
                skill(0);
                range_display(0);
            }
            if (control == 3) {
                document.getElementById("controller_page1").setAttribute("hidden", "hidden");
                document.getElementById("controller_page2").setAttribute("hidden", "hidden");
                document.getElementById("controller_page3").removeAttribute("hidden");
                document.getElementById("controller_button1").style.backgroundColor = "#555b6d";
                document.getElementById("controller_button2").style.backgroundColor = "#555b6d";
                document.getElementById("controller_button3").style.backgroundColor = "rgb(0, 255, 255)";
                range_display(0);
            }
        }
        function skill(skill) {/*控制器技能*/
            state = 0;
            var page = document.getElementById("controller_page3");
            if (skill == 0) {
                var newskill = document.createElement("skill");
                page.replaceChild(newskill, page.childNodes[1]);
                page.childNodes[1].innerHTML = "你点技能啊，点技能图标啊！不点技能图标我怎么知道开什么技能";
                page.childNodes[3].childNodes[1].innerHTML = "我不";
                page.childNodes[3].childNodes[3].innerHTML = "到啊";
                page.childNodes[5].childNodes[1].innerHTML = "要不你猜猜";
            }
            else if (skill == 1) {
                if (document.getElementById(selectid).skill1_name == "无") {
                }
                else {
                    controller(3);
                    var newskill = document.getElementById(selectid).childNodes[skill - 1].cloneNode(true);
                    page.replaceChild(newskill, page.childNodes[1]);
                    page.childNodes[1].removeAttribute("hidden");
                    page.childNodes[3].childNodes[1].innerHTML = document.getElementById(selectid).skill1_cooling;
                    page.childNodes[3].childNodes[3].innerHTML = document.getElementById(selectid).skill1_max_cooling;
                    if (document.getElementById(selectid).skill1_class == 0) {
                        page.childNodes[5].childNodes[1].innerHTML = "被动";
                    }
                    if (document.getElementById(selectid).skill1_class == 1) {
                        page.childNodes[5].childNodes[1].innerHTML = "主动";
                    }
                }
            }
            else if (skill == 2) {
                if (document.getElementById(selectid).skill2_name == "无") {
                }
                else {
                    controller(3);
                    var newskill = document.getElementById(selectid).childNodes[skill - 1].cloneNode(true);
                    page.replaceChild(newskill, page.childNodes[1]);
                    page.childNodes[1].removeAttribute("hidden");
                    page.childNodes[3].childNodes[1].innerHTML = document.getElementById(selectid).skill2_cooling;
                    page.childNodes[3].childNodes[3].innerHTML = document.getElementById(selectid).skill2_max_cooling;
                    if (document.getElementById(selectid).skill2_class == 0) {
                        page.childNodes[5].childNodes[1].innerHTML = "被动";
                    }
                    if (document.getElementById(selectid).skill2_class == 1) {
                        page.childNodes[5].childNodes[1].innerHTML = "主动";
                    }
                }
            }
            else if (skill == 3) {
                if (document.getElementById(selectid).skill3_name == "无") {
                }
                else {
                    controller(3);
                    var newskill = document.getElementById(selectid).childNodes[skill - 1].cloneNode(true);
                    page.replaceChild(newskill, page.childNodes[1]);
                    page.childNodes[1].removeAttribute("hidden");
                    page.childNodes[3].childNodes[1].innerHTML = document.getElementById(selectid).skill3_cooling;
                    page.childNodes[3].childNodes[3].innerHTML = document.getElementById(selectid).skill3_max_cooling;
                    if (document.getElementById(selectid).skill3_class == 0) {
                        page.childNodes[5].childNodes[1].innerHTML = "被动";
                    }
                    if (document.getElementById(selectid).skill3_class == 1) {
                        page.childNodes[5].childNodes[1].innerHTML = "主动";
                    }
                }
            }
        }

        function set(x, n) {
            if (x == 0) {//启动
                document.getElementById('setting').classList.add('active');
            }
            else if (x == -1) {//退出
                document.getElementById('setting').classList.remove('active');
                if (setting[3] == 1 && music_on == 0) {
                    music_on = 1;
                    next_music();
                }
            }
            else if (x == 1 || x == 2) {
                setting[x] = n;
            }
            else if (x == 3 || x == 4) {
                if (setting[x] == 1) {
                    setting[x] = 0;
                    if (x == 3) { document.getElementById('music').pause(); }
                    var name1 = 'setting' + '_' + x + '_' + 1;
                    document.getElementById(name1).style.backgroundColor = 'grey';
                    document.getElementById(name1).style.textDecoration = 'line-through'
                }
                else {
                    setting[x] = 1;
                    if (x == 3) { document.getElementById('music').play(); }
                    var name1 = 'setting' + '_' + x + '_' + 1;
                    document.getElementById(name1).style.backgroundColor = '#00cc00';
                    document.getElementById(name1).style.textDecoration = ''
                }
            }
            document.getElementById('setting_1_0').style.backgroundColor = 'rgb(49, 103, 105)';
            document.getElementById('setting_1_1').style.backgroundColor = 'rgb(49, 103, 105)';
            document.getElementById('setting_1_2').style.backgroundColor = 'rgb(49, 103, 105)';
            document.getElementById('setting_1_3').style.backgroundColor = 'rgb(49, 103, 105)';
            var name1 = 'setting' + '_' + '1' + '_' + setting[1];
            document.getElementById(name1).style.backgroundColor = "rgb(0, 255, 255)";
            document.getElementById('setting_2_0').style.backgroundColor = 'rgb(118, 77, 62)';
            document.getElementById('setting_2_1').style.backgroundColor = 'rgb(118, 77, 62)';
            document.getElementById('setting_2_2').style.backgroundColor = 'rgb(118, 77, 62)';
            var name2 = 'setting' + '_' + '2' + '_' + setting[2];
            document.getElementById(name2).style.backgroundColor = 'rgb(255,69,0)'
        }
        function generate() {
            while (document.getElementById('board').children.length > 0) {
                document.getElementById('board').removeChild(document.getElementById('board').children[0]);
            }
            //生成地块
            if (setting[1] == 0) {
                var r = Math.ceil(Math.random() * 3);
            } else if (setting[1] == 1) {
                var r = 1;
            } else if (setting[1] == 2) {
                var r = 2;
            } else if (setting[1] == 3) {
                var r = 3;
            }
            if (r == 1) {//基础地块
                for (var i = 1; i <= 16; i++) {
                    for (var j = 1; j <= 16; j++) {
                        chess2001(i, j);
                    }
                }
            }
            else if (r == 2) {//石质地块
                for (var i = 1; i <= 16; i++) {
                    for (var j = 1; j <= 16; j++) {
                        var k = Math.ceil(Math.random() * 3);
                        if (k == 1) {
                            chess2002(i, j);
                        }
                        if (k == 2) {
                            chess2003(i, j);
                        }
                        if (k == 3) {
                            chess2004(i, j);
                        }
                    }
                }
            }
            else if (r == 3) {//草地
                for (var i = 1; i <= 16; i++) {
                    for (var j = 1; j <= 16; j++) {
                        var k = Math.ceil(Math.random() * 1);
                        if (k == 1) {
                            chess2005(i, j);
                        }
                        if (k == 2) {
                            chess2007(i, j);
                        }
                    }
                }
            }
            //生成建筑
            if (setting[2] == 0) {
                var r = Math.ceil(Math.random() * 2);
                r = 3;
            }
            else if (setting[2] == 1) {
                var r = 1;
            }
            else if (setting[2] == 2) {
                var r = 2;
            }
            if (r == 1) {
                var list = [[4, 1], [4, 2], [5, 3], [1, 5], [2, 5], [3, 5], [3, 12], [1, 9], [2, 9], [3, 9], [1, 13], [2, 13], [3, 13], [5, 16], [5, 15], [6, 14], [8, 1], [8, 2], [8, 3], [12, 1], [12, 2], [12, 3], [14, 3], [15, 4], [16, 4], [13, 11], [9, 16], [9, 15], [9, 14], [13, 16], [13, 15], [13, 14], [14, 8], [15, 8], [16, 8], [14, 12], [15, 12], [16, 12], [5, 12], [5, 11], [5, 10], [6, 8], [7, 8], [9, 8], [10, 8], [11, 9], [9, 11], [10, 6], [9, 12]]
                for (var i = 0; i < list.length; i++) {
                    chess1001(list[i][0], list[i][1]);
                }
            }
            else if (r == 2) {
                var list = [[1, 7], [1, 15], [1, 16], [2, 5], [2, 7], [2, 13], [2, 16], [3, 3], [3, 7], [3, 10], [3, 14], [4, 2], [4, 10], [4, 11], [5, 2], [5, 4], [5, 5], [5, 11], [6, 7], [6, 8], [6, 11], [6, 12], [6, 15], [7, 3], [7, 6], [7, 7], [8, 1], [8, 5], [8, 6], [8, 9], [8, 15], [8, 16], [9, 1], [9, 2], [9, 8], [9, 11], [9, 12], [9, 16], [10, 10], [10, 11], [10, 14], [11, 2], [11, 5], [11, 6], [11, 9], [11, 10], [12, 6], [12, 12], [12, 13], [12, 15], [13, 6], [13, 7], [13, 15], [14, 3], [14, 7], [14, 10], [14, 14], [15, 1], [15, 4], [15, 10], [15, 12], [16, 1], [16, 2], [16, 10]]
                for (var i = 0; i < list.length; i++) {
                    chess1001(list[i][0], list[i][1]);
                }
            }
            else if (r == 3) {
                var list = [[4, 4], [11, 9], [9, 11], [8, 11], [11, 8], [7, 10], [10, 7], [6, 11], [11, 6], [13, 13], [9, 12], [12, 9], [7, 13], [13, 7], [6, 13], [13, 6], [8, 14], [14, 8], [9, 14], [14, 9], [5, 13], [4, 12], [3, 13], [13, 5], [12, 4], [13, 3], [7, 15], [15, 7], [6, 15], [15, 6], [5, 10], [10, 5], [5, 9], [9, 5], [3, 10], [10, 3], [3, 9], [9, 3], [3, 8], [8, 3], [5, 8], [8, 5], [3, 7], [7, 3], []];
                for (var i = 0; i < list.length; i++) {
                    chess1001(list[i][0], list[i][1]);
                }
            }
            else if (r == 4) {
                var list = [[1, 5], [2, 2], [2, 5], [2, 6], [2, 11], [2, 12], [2, 15], [3, 3], [3, 6], [3, 8], [3, 9], [3, 14], [4, 4], [4, 8], [4, 9], [4, 13], [5, 2], [5, 6], [5, 11], [5, 15], [5, 16], [6, 2], [6, 3], [6, 5], [6, 6], [6, 11], [6, 12], [6, 14], [6, 15], [7, 7], [7, 10], [8, 3], [8, 4], [8, 13], [8, 14], [9, 3], [9, 4], [9, 13], [9, 14], [10, 7], [10, 10], [11, 2], [11, 3], [11, 5], [11, 6], [11, 11], [11, 12], [11, 14], [11, 15], [12, 1], [12, 2], [12, 6], [12, 11], [12, 15], [13, 4], [13, 8], [13, 9], [13, 13], [14, 3], [14, 6], [14, 8], [14, 9], [14, 11], [14, 14], [15, 2], [15, 5], [15, 6], [15, 11], [15, 12], [15, 15], [16, 12]];
                for (var i = 0; i < list.length; i++) {
                    chess1001(list[i][0], list[i][1]);
                }
            }
        }
        function born(x, n) {//x是当前按钮元素，n是chess的fixedid
            if (creation == n) {
                state = 0;
                creation = 0;
                if (document.querySelector('.born')) {
                    document.querySelector('.born').classList.remove('born');
                }
            }
            else {
                state = 4;
                creation = n;
                //x.style.backgroundColor = 'red';
                if (document.querySelector('.born')) {
                    document.querySelector('.born').classList.remove('born');
                }
                x.classList.add('born');
            }
        }
        function hit(id, hit_health, hit_class, source, x, y) {
            if (document.getElementById(source)) {
                document.getElementById(id).hitfunction(id, hit_health - document.getElementById(source).effect_sum[7], hit_class, source, x, y)
            } else {
                document.getElementById(id).hitfunction(id, hit_health, hit_class, source, x, y)
            }
        }
        function next_music(x) {
            var music_list = ['./audio/Aflame_Avenue.mp3', './audio/ALIVE.ogg', './audio/Boiling_Blood.ogg', './audio/CONFRONT-伟伟-161637492-128.mp3', './audio/Curtain_Call-伟伟-161637491-128.mp3', './audio/El_Brillo_Solitario-伟伟-161637489-128.mp3', './audio/Evolutionary_Mechanization-伟伟-161637459-128.mp3', './audio/genshin.mp3', './audio/Lily_of_the_Valley-伟伟-161637485-128.mp3', './audio/LITHOS-伟伟-161638250-128.mp3', './audio/Lullabye-伟伟-161638256-100.ogg', './audio/Not_Your_Business_Part_2-伟伟-161638243-128.mp3', './audio/Ready_？-伟伟-161638228-100.ogg', './audio/Reconnection-伟伟-161638190-128.mp3', './audio/Renegade-伟伟-161638241-100.ogg', './audio/Requiem-伟伟-161638193-100.ogg', './audio/Reversed_Time-伟伟-161638232-100.ogg', './audio/Rock_the_Night_Away-伟伟-161638212-128.mp3', './audio/Sparkling_Hydraulics-伟伟-161638224-128.mp3', './audio/Speed_of_Light_(Inst_)-伟伟-161638196-100.ogg', './audio/Stay_Gold-伟伟-161638188-128.mp3', './audio/Synthetech-伟伟-161638189-128.mp3', './audio/Till_the_Bell_Tolls-伟伟-161638187-100.ogg', './audio/Tipsy-伟伟-161638180-100.ogg', './audio/Untitled_world-伟伟-161638181-100.ogg', './audio/Zone_10⁻⁸-伟伟-161638182-128.mp3', './audio/УраУра-伟伟-161638186-128.mp3', './audio/人性-伟伟-161637046-128.mp3', './audio/从那高地上远眺-伟伟-161638184-128.mp3', './audio/冬涤- 伟伟-161637103-128.mp3', './audio/夏浪-伟伟-161637047-128.mp3', './audio/大柏墟-伟伟-161637087-128.mp3', './audio/执棋者之骨-伟伟-161637036-128.mp3', './audio/故乡的风-伟伟-161637064-128.mp3', './audio/旅途前方-伟伟-161637089-128.mp3', './audio/春弦-伟伟-161638183-100.ogg', './audio/永冻症- 伟伟-161637048-128.mp3', './audio/泛用型自动化解决方案0_3_2_9f2-伟伟-161637099-128.mp3', './audio/独行长路-伟伟-161637122-128.mp3', './audio/生命 流-伟伟-161637040-100.ogg', './audio/短兵相接-伟伟-161637053-128.mp3', './audio/示岁-伟伟-161637043-128.mp3', './audio/秋绪-伟伟-161637041-100.ogg', './audio/终局抵抗者-伟伟-161637042-128.mp3', './audio/血液-伟伟-161637037-128.mp3', './audio/逃亡_part2-伟伟-161637044-128.mp3'];
            var audio = document.createElement('audio');
            audio.src = music_list[Math.ceil(Math.random() * 46)];
            audio.setAttribute('autoplay', 'autoplay')
            audio.id = 'music';
            audio.addEventListener('ended', function () { next_music(this) })
            document.getElementById("body").appendChild(audio);
            document.getElementById('body').removeChild(x);
        }

        function anim1(x, y) {//受击动画300ms
            var opa = 0;
            var p1 = document.createElement("img");
            p1.id = pid;
            p1.src = "./img/particle1.png";
            p1.style.position = "absolute";
            p1.style.height = 25 + "px";
            p1.style.width = 25 + "px";
            p1.style.left = (x - 1) * 25 + "px";
            p1.style.bottom = (y - 1) * 25 + "px";
            p1.style.opacity = 0;
            p1.style.zIndex = 120;
            document.getElementById("p_board").appendChild(p1);
            var anim1_1 = setInterval(function () { opa += 0.033; document.getElementById(p1.id).style.opacity = opa; }, 10);
            setTimeout(function () { anim1_2() }, 150);
            function anim1_2() {
                clearInterval(anim1_1);
                var anim1_3 = setInterval(function () { opa -= 0.033; document.getElementById(p1.id).style.opacity = opa }, 10);
                setTimeout(function () { document.getElementById("p_board").removeChild(document.getElementById(p1.id)); }, 150);
            }
            pid++;
        }
        function anim2(x1, y1, x2, y2, num) {//远程攻击动画150ms
            var p1 = document.createElement("img");
            var x = (x1 - 1) * 25;
            var y = (y1 - 1) * 25;
            if (x2 - x1 == 0) {
                if (y2 - y1 >= 0) { var zita = 0; }
                else { var zita = 180; }
            }
            else if (x2 - x1 > 0) {
                var zita = 90 - Math.atan((y2 - y1) / (x2 - x1)) * 180 / Math.PI;
            }
            else if (x2 - x1 < 0) {
                var zita = 270 - Math.atan((y2 - y1) / (x2 - x1)) * 180 / Math.PI;
            }
            p1.id = pid;
            p1.src = "./img/particle" + num + ".png";
            p1.style.position = "absolute";
            p1.style.height = 25 + "px";
            p1.style.width = 25 + "px";
            p1.style.left = x + "px";
            p1.style.bottom = y + "px";
            p1.style.transform = "rotate(" + zita + "deg)"
            p1.style.zIndex = 120;
            document.getElementById("p_board").appendChild(p1);
            var anim2_1 = setInterval(function () { x += (x2 - x1) * 25 / 15; y += (y2 - y1) * 25 / 15; document.getElementById(p1.id).style.left = x + "px"; document.getElementById(p1.id).style.bottom = y + "px"; }, 10);
            setTimeout(function () { document.getElementById("p_board").removeChild(document.getElementById(p1.id)); }, 150);
            pid++;
        }
        function anim3(x, y, count) {//治疗粒子效果1000ms
            var p1 = document.createElement("img");
            var a = 0
            var x0 = (x - 1 + Math.random() / 2 - 0.25) * 25 + 5.7;
            var y0 = (y - 1 + Math.random() / 2 - 0.25) * 25 + 5.7;
            p1.id = pid;
            p1.src = "./img/particle5.png";
            p1.style.position = "absolute";
            p1.style.height = 10 + "px";
            p1.style.width = 10 + "px";
            p1.style.zIndex = 120;
            p1.style.left = x0 + "px";
            p1.style.bottom = y0 + "px";
            document.getElementById("p_board").appendChild(p1);
            var inter = setInterval(function () { a++; y0 += 3 / a; document.getElementById(p1.id).style.bottom = y0 + "px"; }, 10);
            setTimeout(function () { document.getElementById("p_board").removeChild(document.getElementById(p1.id)); clearInterval(inter); }, 1000);
            pid++;
            if (count > 1) {
                anim3(x, y, count - 1);
            }
        }
        function anim4(x, y, count) {//伤害粒子效果1000ms
            var p1 = document.createElement("img");
            var a = 0
            var x0 = (x - 1 + Math.random() / 2 - 0.25) * 25 + 7.5;
            var y0 = (y - 1 + Math.random() / 2 - 0.25) * 25 + 7.5;
            p1.id = pid;
            p1.src = "./img/particle4.png";
            p1.style.position = "absolute";
            p1.style.height = 10 + "px";
            p1.style.width = 10 + "px";
            p1.style.opacity = 0.7;
            p1.style.zIndex = 120;
            p1.style.left = x0 + "px";
            p1.style.bottom = y0 + "px";
            document.getElementById("p_board").appendChild(p1);
            var inter = setInterval(function () { a++; y0 += 3 / a; document.getElementById(p1.id).style.bottom = y0 + "px"; }, 10);
            setTimeout(function () { document.getElementById("p_board").removeChild(document.getElementById(p1.id)); clearInterval(inter); }, 1000);
            pid++;
            if (count > 1) {
                anim4(x, y, count - 1);
            }
        }
        function anim5(x, y) {//死亡特效3000ms
            var p1 = document.createElement("img");
            var opa = 1;
            p1.id = pid;
            p1.src = "./img/particle6.png";
            p1.style.position = "absolute";
            p1.style.height = 25 + "px";
            p1.style.width = 25 + "px";
            p1.style.left = (x - 1) * 25 + "px";
            p1.style.bottom = (y - 1) * 25 + "px";
            p1.style.zIndex = 120;
            document.getElementById("p_board").appendChild(p1);
            var inter = setInterval(function () { opa -= 0.00333; document.getElementById(p1.id).style.opacity = opa; }, 10);
            setTimeout(function () { document.getElementById("p_board").removeChild(document.getElementById(p1.id)); clearInterval(inter); }, 3000);
            pid++;
        }
        function anim6(x, y) { }
        function anim7(x, y) { }
        function anim8(x, y) { }
    </script>
    <script src="./character/chess1.js">//忍者</script>
    <script src="./character/chess4.js">//狂刀</script>
    <script src="./character/chess5.js">//无人机操控者</script>
    <script src="./character/chess6.js">//红王</script>
    <script src="./character/chess7.js">//军火商</script>
    <script src="./character/chess8.js">//拳击手</script>
    <script src="./character/chess9.js">//定神游</script>
    <script src="./character/chess10.js">//</script>
    <script src="./character/chess1001.js">//障碍物</script>
    <script src="./character/chess1005.js">//战斗无人机</script>
    <script src="./character/chess1006.js">//救治无人机</script>
    <script src="./character/chess1007.js">//机枪</script>
    <script src="./character/chess1008.js">//大炮</script>
    <script src="./character/chess1009.js">//沙袋</script>
    <script src="./character/chess1010.js">//草史莱姆</script>
    <script src="./character/chess1011.js">//水史莱姆</script>
    <script src="./character/chess1012.js">//火史莱姆</script>
    <script src="./character/chess1013.js">//土史莱姆</script>
    <script src="./character/chess1014.js">//金史莱姆</script>
    <script src="./character/chess1015.js">//风史莱姆</script>
    <script src="./character/chess2001.js">//基础地块</script>
    <script src="./character/chess2002.js">//石块</script>
    <script src="./character/chess2003.js">//石砖</script>
    <script src="./character/chess2004.js">//苔石砖</script>
    <script src="./character/chess2005.js">//草地</script>
    <script src="./character/chess2006.js">//积水草地</script>
    <script src="./character/chess2007.js">//芦苇</script>
    <script src="./character/chess2008.js">//地刺</script>
    <style>
        chess0 {
            display: block;
            position: absolute;
            width: 25px;
            height: 25px;
            background-size: 25px;
        }

        p {
            margin: 0px;
        }

        skill {
            margin: 0px;
        }

        button:not(.born) {
            background-color: white;
            height: 40px;
            border-width: 1px;
        }

        button.born {
            height: 40px;
            background-color: wheat;
            border-color: red;
            border-width: 3px;
        }

        p.md {
            color: rgb(234, 82, 16);
            text-decoration: underline;
            text-decoration-color: rgb(212, 108, 28);
            display: inline
        }

        #setting:not(.active) {
            display: none;
        }

        #setting.active {
            display: block;
        }

        #next {
            top: 0px;
            right: 0px;
            opacity: 1;
            transition: 0.7s;
        }

        #next.fade {
            top: -50px;
            right: 0px;
            opacity: 0;
            transition: 0.7s;
        }

        #next.emerge {
            top: 0px;
            right: -50px;
            opacity: 0;
            transition: 0s;
        }

        .round {
            display: flex;
            left: calc(50% - 175px);
            transition: 0.8s cubic-bezier(0.1, 0.7, 0, 1);
        }

        .round_fade {
            display: flex;
            left: -350px;
            transition: 0.8s cubic-bezier(0.1, 0.7, 0, 1);
        }

        .round_emerge {
            display: flex;
            left: calc(100%);
            transition: 0s;
        }

        .turn_active {
            background-color: rgb(0, 128, 0);
        }

        .turn_inactive {
            background-color: rgb(255, 0, 0);
        }

        * {
            scrollbar-width: none;
        }
    </style>
</head>

<body style="margin:0px" id="body">
    <div
        style="display: flex; flex-direction: row; height: 50px;background-color: #555b6d;background: url(img/back1.png) no-repeat;background-size:100% 100px;">
        <p style="background-color:black;color: white;width: 200px;font-size:30px;padding: 5px;">回合:
            <b id="round">0</b>
        </p>
        <p style="position: absolute;right: 0px;height: 50px;width: 50px;background-color: white;"></p>
        <img style="position: absolute;height: 50px;width: 50px;" id="next" width="50" src=" " height="50">
        <p style="position: absolute;right: 0px; height: 50px;width: 50px;cursor: pointer;background-color: rgb(0,0,0,0);color: rgb(1,1,1,0.5);"
            onclick="next_act()">
            *结束<br>行动*</p>
    </div>
    <!--棋盘-->
    <div id="p_board" style="position: absolute; width: 400px;height: 400px;top: 50px;pointer-events: none;"></div>
    <div id="board" style="position:relative;height:400px;"></div>
    <div id="effect_board"
        style="position: absolute; width: 400px;height: 400px;top: 50px;display: flex;flex-direction: column-reverse;justify-content: flex-start;pointer-events: none;">
    </div>
    <div hidden id="overall_skill"></div>
    <script>generate();</script>
    <script>//测试
        //document.getElementById(2).innerHTML = route(1, 1, 5, 5, 0, 0, 0, 0, 0)[0]; 
    </script>
    <div style="display: flex;">

        <!--目标选择器-->

        <div id="selector" style="background-image:url(img/back2.png) ;width:200px;height: 200px; ">
            <img id="img" src="./img/void.png" width="100px" height="100px" alt=" "
                style="position: absolute;left: 100px;">
            <p style="display: inline;">目标:</p><b id="name" style="display: inline"></b><br>
            <p style="display: inline;">血量:</p><b id="health" style="display: inline"></b><b>/</b><b id="max_health"
                style="display: inline"></b><b id="health_modification"></b><br>
            <p style="display: inline;">移动:</p><b id="movement" style="display: inline"></b><b>/</b><b id="max_movement"
                style="display: inline"></b><b id="movement_modification"></b><br>
            <p style="display: inline;">反应:</p><b id="reflect" style="display: inline"></b><b
                id="reflect_modification"></b><br>
            <!--<p style="display: inline;">id:</p><b id="iid" style="display: inline"></b><br>
            <p style="display: inline;">fixedid:</p><b id="fixedid" style="display: inline"></b><br>-->
            <!--skill-->
            <p>技能:</p>
            <div style="display:flex;flex-direction: row;height: 66.6px;">
                <div id="skill1" style="width: 66.6px;">
                    <img src="./img/void.png" width="50px" height="50px" onclick="skill(1)" style="cursor: pointer;">
                    <p style="font-size:10px;"></p>
                </div>
                <div id="skill2" style="width: 66.6px;">
                    <img src="./img/void.png" width="50px" height="50px" onclick="skill(2)" style="cursor: pointer;">
                    <p style="font-size:10px;"></p>
                </div>
                <div id="skill3" style="width: 66.6px;">
                    <img src="./img/void.png" width="50px" height="50px" onclick="skill(3)" style="cursor: pointer;">
                    <p style="font-size:10px;"></p>
                </div>
            </div>
        </div>
        <div style="display: flex;flex-direction: column;">

            <!--控制区索引-->

            <div style="display: flex;flex-direction: row;height:30px;background-color: #555b6d;width:200px;">
                <button id="controller_button1" onclick="controller(1)"
                    style="background-color: #555b6d;border-radius: 0px;height:30px;width:30px;border: 0px;">生</button>
                <button id="controller_button2" onclick="controller(2)"
                    style="background-color: #555b6d;border-radius: 0px;height:30px;width:30px;border: 0px;">移</button>
                <button id="controller_button3" onclick="controller(3)"
                    style="background-color: #555b6d;border-radius: 0px;height:30px;width:30px;border: 0px;">技</button>
            </div>

            <!--控制区-->

            <div style="background-color: aqua;height:170px;position: relative ;">

                <!--1生-->

                <div id="controller_page1" hidden>
                    <!--<button onclick="chess3(1,1)">小道行者</button>-->
                    <button onclick="born(this,1);" style="border-radius: 5px; ">忍者</button>
                    <button onclick="born(this,4);" style="border-radius: 5px; ">狂刀</button>
                    <button onclick="born(this,5);" style="border-radius: 5px; ">无人机操控者</button>
                    <button onclick="born(this,6);" style="border-radius: 5px; ">红王</button>
                    <button onclick="born(this,7);" style="border-radius: 5px; ">军火商</button>
                    <button onclick="born(this,8);" style="border-radius: 5px; ">拳击手</button>
                    <button onclick="born(this,9);" style="border-radius: 5px; ">定神游</button>
                    <button onclick="born(this,1010)" style="border-radius: 5px; ">史莱姆</button>
                    <button onclick="set(0)"
                        style="background-image:url('./img/setting.png');background-color: aqua;background-size: 50px 50px;width: 50px;height: 50px;border: 0px;position: absolute;bottom: 0px;right: 0px;"></button>
                </div>

                <!--2移-->

                <div id="controller_page2" hidden
                    style="position: absolute ;height: 60px;width:60px;left:70px;top: 56px; ">
                    <p class="turn"
                        onclick="if (turn == 0) { var x = $('.turn')[0]; x.innerHTML='转向 是' ; x.style.backgroundColor='green';turn=1; } else { var x=$('.turn')[0]; x.innerHTML='转向 否' ;x.style.backgroundColor='red'; turn=0; }"
                        style="width: 40px;height: 40px;border-radius: 0px;position: relative;top: 10px;left: 10px;text-align: center;font-size: 14px;cursor: pointer;background-color: red;">
                        转向 否</p>
                    <img src="./img/arrow.png" width="60px" height="50px"
                        onclick="document.getElementById(selectid).movefunction(selectid,1,1,0,0,0,0)"
                        style="transform:rotate(0deg)  ;position: absolute;left:0px;top: -50px;cursor: pointer;">
                    <img src="./img/arrow.png" width="60px" height="50px"
                        onclick="document.getElementById(selectid).movefunction(selectid,2,1,0,0,0,0)"
                        style="transform: rotate(90deg)  ;position: absolute;left:55px;top: 5px;cursor: pointer;">
                    <img src="./img/arrow.png" width="60px" height="50px"
                        onclick="document.getElementById(selectid).movefunction(selectid,3,1,0,0,0,0)"
                        style="transform: rotate(180deg)  ;position: absolute;left:0px;top: 60px;cursor: pointer;">
                    <img src="./img/arrow.png" width="60px" height="50px"
                        onclick="document.getElementById(selectid).movefunction(selectid,4,1,0,0,0,0)"
                        style="transform: rotate(270deg)  ;position: absolute;left:-54px;top:5px;cursor: pointer;">
                </div>

                <!--3技-->

                <div id="controller_page3" hidden>
                    <skill></skill>
                    <p style="position: absolute;bottom: 20px;">冷却：<b></b>/<b></b>(回合)</p>
                    <p style="position: absolute;bottom: 0px;">类型：<b></b></p>

                </div>
            </div>
        </div>
    </div>
    <div id="setting" onclick="set(-1)"
        style="z-index:490;height: 100%;width: 100%;background-color: rgb(0,0,0,0.5);position: fixed;top: 0px;left: 0px;">
        <div id="setting_1"
            style="width: 200px;height: 300px;overflow:auto;background-color: white;position: fixed;top: 130px;left: calc(50% - 100px);z-index: 501;border-radius: 5px;">
            <button onclick="set(3,1)" id="setting_3_1"
                style="position: relative;margin: 20px;margin-bottom: 0px;margin-right: 0px;background-color: #00cc00;border-radius: 5px;">背景音乐</button>
            <button onclick="set(4,1)" id="setting_4_1"
                style="position: relative;margin: 20px;margin-bottom: 0px;margin-right: 0px;background-color: #00cc00;border-radius: 5px;">游戏音效</button>
            <p style="width: 200px;height: 1px;background-color: black;position: relative;top: 10px;"></p>
            <button onclick="set(1,0)" id="setting_1_0"
                style="position: relative;margin: 20px;margin-bottom: 0px;margin-right: 0px;background-color: grey;border-radius: 5px;">随机地板</button>
            <button onclick="set(1,1)" id="setting_1_1"
                style="position: relative;margin: 20px;margin-bottom: 0px;margin-right: 0px;background-color: grey;border-radius: 5px;">基础地板</button>
            <button onclick="set(1,2)" id="setting_1_2"
                style="position: relative;margin: 20px;margin-bottom: 0px;margin-right: 0px;background-color: grey;border-radius: 5px;">石质地板</button>
            <button onclick="set(1,3)" id="setting_1_3"
                style="position: relative;margin: 20px;margin-bottom: 0px;margin-right: 0px;background-color: grey;border-radius: 5px;">草地地板</button>
            <p style="width: 200px;height: 1px;background-color: black;position: relative;top: 10px;"></p>
            <button onclick="set(2,0)" id="setting_2_0"
                style="position: relative;margin: 20px;margin-bottom: 0px;margin-right: 0px;background-color: grey;border-radius: 5px;">随机地图</button>
            <button onclick="set(2,1)" id="setting_2_1"
                style="position: relative;margin: 20px;margin-bottom: 0px;margin-right: 0px;background-color: grey;border-radius: 5px;">一堆房间</button>
            <button onclick="set(2,2)" id="setting_2_2"
                style="position: relative;margin: 20px;margin-bottom: 0px;margin-right: 0px;background-color: grey;border-radius: 5px;">错综复杂</button>
            <p style="width: 200px;height: 1px;background-color: black;position: relative;top: 10px;"></p>
            <button onclick="generate()"
                style="position: relative;margin: 20px;height: 30px;margin-bottom: 0px;margin-right: 0px;">重新加载</button>
        </div>
    </div>
    <div id="round_over" class="round_fade"
        style="justify-content: center;align-items: center;position: absolute;top: 225px;z-index: 200;opacity: 0.85;">
        <img src="./img/round_over.png" width="350px">
        <p id="round_over_p" style="position: absolute;">123</p>
    </div>
    <div id="round_start" class="round_fade"
        style="justify-content: center;align-items: center;position: absolute;top: 225px;z-index: 200;opacity: 0.85;">
        <img src="./img/round_start.png" width="350px">
        <p id="round_start_p" style="position: absolute;color: aliceblue;">123</p>
    </div>
    <script>
        set(0);
        document.getElementById('setting_1').onclick = function (event) { event.stopPropagation(); }
        document.addEventListener('keypress', function (event) {
            var k = event.key;
            if (k == 'w') {
                document.getElementById(selectid).movefunction(selectid, 1, 1, 0, 0, 0, 0);
            } else if (k == 'd') {
                document.getElementById(selectid).movefunction(selectid, 2, 1, 0, 0, 0, 0);
            } else if (k == 's') {
                document.getElementById(selectid).movefunction(selectid, 3, 1, 0, 0, 0, 0);
            } else if (k == 'a') {
                document.getElementById(selectid).movefunction(selectid, 4, 1, 0, 0, 0, 0);
            } else if (k == 'x') {
                if (turn == 0) { var x = $('.turn')[0]; x.innerHTML = '转向 是'; x.style.backgroundColor = 'green'; turn = 1; } else { var x = $('.turn')[0]; x.innerHTML = '转向 否'; x.style.backgroundColor = 'red'; turn = 0; }
                controller(2);
            } else if (k == '1') {
                skill(1);
            } else if (k == '2') {
                skill(2);
            } else if (k == '3') {
                skill(3);
            } else if (k == 'Enter' || k == 'f') {
                $('#controller_page3>skill>button').click();
            } else if (k == ' ') {
                next_act();
            }
        })
        //$(".turn_inactive")[0].addEventListener('click', function () { if (turn == 0) { var x = $(".turn_inactive")[0]; x.classList = 'turn_active'; x.innerHTML = '转向 是'; turn = 1; } else { var x = $(".turn_active")[0]; x.classList = 'turn_inactive'; x.innerHTML = '转向 否'; turn = 0; } });
        /* function turn_inactive() {
            $(".turn_inactive")[0].addEventListener('click', function () { var x = $(".turn_inactive")[0]; x.classList = 'turn_active'; x.innerHTML = '转向 是'; turn = 1; turn_active() });
        }
        function turn_active() {
            $(".turn_active")[0].addEventListener('click', function () { var x = $(".turn_active")[0]; x.classList = 'turn_inactive'; x.innerHTML = '转向 否'; turn = 0; turn_inactive() });
        }*/
        /* $(function () {
             $("#board").draggable({ axis: "x" });
         });*/
    </script>
</body>

</html>